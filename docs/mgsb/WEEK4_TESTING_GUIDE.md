# Week 4 테스트 및 검증 가이드

## 개요
Week 4에서 구현한 ERD 조회 및 시각화 기능에 대한 테스트 및 검증 가이드입니다.

## 백엔드 테스트

### 1. ERD 컨트롤러 통합 테스트
**파일**: `src/test/java/com/coresolution/core/controller/ErdControllerIntegrationTest.java`

**테스트 항목**:
- ✅ 테넌트 ERD 목록 조회 성공
- ✅ 다른 테넌트 ERD 목록 조회 실패 (권한 없음)
- ✅ ERD 상세 조회 성공
- ✅ 존재하지 않는 ERD 조회 실패
- ✅ 다른 테넌트 ERD 상세 조회 실패 (권한 없음)
- ✅ ERD 변경 이력 조회 성공
- ✅ ERD 변경 이력 조회 - 빈 목록
- ✅ ERD 목록 조회 - 빈 목록
- ✅ ERD 상세 조회 - Mermaid 코드 형식 검증

**실행 방법**:
```bash
./mvnw test -Dtest=ErdControllerIntegrationTest
```

### 2. ERD 생성 서비스 통합 테스트
**파일**: `src/test/java/com/coresolution/core/service/impl/ErdGenerationServiceIntegrationTest.java`

**테스트 항목**:
- ✅ 전체 시스템 ERD 생성
- ✅ 테넌트별 ERD 생성
- ✅ 모듈별 ERD 생성
- ✅ 커스텀 ERD 생성
- ✅ ERD 재생성
- ✅ 테넌트별 ERD 목록 조회
- ✅ ERD 메타데이터 저장

**실행 방법**:
```bash
./mvnw test -Dtest=ErdGenerationServiceIntegrationTest
```

### 3. 온보딩 승인 서비스 통합 테스트
**파일**: `src/test/java/com/coresolution/core/service/impl/OnboardingApprovalServiceIntegrationTest.java`

**테스트 항목**:
- ✅ 온보딩 승인 시 ERD 자동 생성
- ✅ PL/SQL 프로시저 호출 검증

**실행 방법**:
```bash
./mvnw test -Dtest=OnboardingApprovalServiceIntegrationTest
```

## 프론트엔드 테스트

### 1. ERD 목록 페이지 테스트

**접근 경로**: `/tenant/erd`

**검증 항목**:
1. **ERD 목록 표시**
   - 테넌트의 ERD 목록이 카드 형태로 표시되는지 확인
   - ERD 이름, 타입, 버전, 상태가 표시되는지 확인
   - 활성/비활성 상태 배지가 올바르게 표시되는지 확인

2. **필터링 기능**
   - 타입별 필터 (전체/테넌트/모듈/커스텀) 동작 확인
   - 상태별 필터 (전체/활성/비활성) 동작 확인

3. **네비게이션**
   - ERD 카드 클릭 시 상세 페이지로 이동하는지 확인
   - "새 ERD 생성" 버튼 동작 확인 (향후 구현)

4. **반응형 디자인**
   - 모바일/태블릿/데스크탑에서 레이아웃이 올바르게 표시되는지 확인
   - 카드 그리드가 화면 크기에 따라 조정되는지 확인

### 2. ERD 상세 페이지 테스트

**접근 경로**: `/tenant/erd/:diagramId`

**검증 항목**:

#### 2.1 기본 기능
1. **ERD 정보 표시**
   - ERD 이름, 타입, 버전, 상태가 헤더에 표시되는지 확인
   - 설명이 있는 경우 표시되는지 확인

2. **탭 전환**
   - 다이어그램/변경 이력/텍스트 ERD 탭 전환 동작 확인
   - 각 탭의 내용이 올바르게 표시되는지 확인

#### 2.2 Mermaid.js 렌더링
1. **ERD 다이어그램 표시**
   - Mermaid.js로 ERD가 올바르게 렌더링되는지 확인
   - 테이블과 관계선이 표시되는지 확인
   - 다이어그램이 SVG로 렌더링되는지 확인

2. **렌더링 오류 처리**
   - 잘못된 Mermaid 코드의 경우 오류 메시지가 표시되는지 확인

#### 2.3 인터랙티브 기능
1. **테이블 클릭**
   - 테이블 클릭 시 하이라이트되는지 확인
   - 관련 관계선이 강조 표시되는지 확인
   - 선택 정보 패널에 테이블 이름이 표시되는지 확인

2. **관계선 클릭**
   - 관계선 클릭 시 하이라이트되는지 확인
   - 관련 테이블이 강조 표시되는지 확인
   - 선택 정보 패널에 관계 정보가 표시되는지 확인

3. **호버 효과**
   - 테이블/관계선에 마우스 오버 시 미리보기 효과가 표시되는지 확인
   - 호버된 요소 정보가 선택 정보 패널에 표시되는지 확인

4. **선택 초기화**
   - 외부 클릭 시 선택이 초기화되는지 확인
   - 선택 정보 패널의 닫기 버튼 동작 확인

#### 2.4 확대/축소 기능
1. **확대/축소 버튼**
   - 확대 버튼 (+) 클릭 시 다이어그램이 확대되는지 확인
   - 축소 버튼 (-) 클릭 시 다이어그램이 축소되는지 확인
   - 확대/축소 레벨이 올바르게 표시되는지 확인 (현재 %)
   - 리셋 버튼 (⌂) 클릭 시 원래 크기로 복원되는지 확인

2. **마우스 휠 확대/축소**
   - 마우스 휠 위로 스크롤 시 확대되는지 확인
   - 마우스 휠 아래로 스크롤 시 축소되는지 확인
   - 확대/축소 범위가 50% ~ 300%로 제한되는지 확인

3. **팬 기능**
   - 마우스 드래그로 다이어그램을 이동할 수 있는지 확인
   - 커서가 grab/grabbing으로 변경되는지 확인
   - 이동 애니메이션이 부드럽게 동작하는지 확인

#### 2.5 필터링 기능
1. **테이블 이름 검색**
   - 검색 입력란에 테이블 이름 입력 시 필터링되는지 확인
   - 대소문자 구분 없이 검색되는지 확인
   - 부분 일치 검색이 동작하는지 확인
   - 필터링된 테이블만 표시되고 나머지는 숨겨지는지 확인

2. **선택된 항목만 표시**
   - 체크박스 선택 시 선택된 테이블/관계만 표시되는지 확인
   - 관련 관계선도 함께 표시되는지 확인
   - 체크박스 해제 시 모든 항목이 다시 표시되는지 확인

3. **필터 패널 토글**
   - 필터 토글 버튼 클릭 시 패널이 열리고 닫히는지 확인
   - 패널이 올바른 위치에 표시되는지 확인

#### 2.6 변경 이력 탭
1. **이력 목록 표시**
   - 변경 이력이 시간순으로 표시되는지 확인
   - 버전, 변경 타입, 변경 설명이 표시되는지 확인
   - 변경 일시가 올바르게 표시되는지 확인

2. **이력 상세 정보**
   - 각 이력 항목의 상세 정보가 표시되는지 확인

#### 2.7 텍스트 ERD 탭
1. **텍스트 ERD 표시**
   - 텍스트 ERD가 올바르게 표시되는지 확인
   - 포맷팅이 올바른지 확인

### 3. API 통합 테스트

**테스트 도구**: Postman, curl, 또는 브라우저 개발자 도구

**API 엔드포인트**:

1. **테넌트 ERD 목록 조회**
   ```
   GET /api/v1/tenants/{tenantId}/erd
   ```
   - 인증 토큰 필요
   - 테넌트 ID가 올바르게 설정되어 있는지 확인
   - 응답이 JSON 배열인지 확인

2. **ERD 상세 조회**
   ```
   GET /api/v1/tenants/{tenantId}/erd/{diagramId}
   ```
   - 인증 토큰 필요
   - Mermaid 코드가 포함되어 있는지 확인
   - 텍스트 ERD가 포함되어 있는지 확인

3. **ERD 변경 이력 조회**
   ```
   GET /api/v1/tenants/{tenantId}/erd/{diagramId}/history
   ```
   - 인증 토큰 필요
   - 이력 목록이 시간순으로 정렬되어 있는지 확인

## 수동 테스트 체크리스트

### 백엔드
- [ ] ERD 목록 조회 API 정상 동작
- [ ] ERD 상세 조회 API 정상 동작
- [ ] ERD 변경 이력 조회 API 정상 동작
- [ ] 테넌트 권한 검증 동작
- [ ] 존재하지 않는 ERD 조회 시 오류 처리
- [ ] Mermaid 코드 생성 정확성

### 프론트엔드
- [ ] ERD 목록 페이지 로드 및 표시
- [ ] ERD 상세 페이지 로드 및 표시
- [ ] Mermaid.js 렌더링 정상 동작
- [ ] 테이블 클릭 하이라이트 동작
- [ ] 관계선 클릭 하이라이트 동작
- [ ] 확대/축소 버튼 동작
- [ ] 마우스 휠 확대/축소 동작
- [ ] 드래그 팬 동작
- [ ] 테이블 이름 검색 필터 동작
- [ ] 선택된 항목만 표시 필터 동작
- [ ] 변경 이력 탭 표시
- [ ] 텍스트 ERD 탭 표시
- [ ] 반응형 디자인 (모바일/태블릿/데스크탑)

## 성능 테스트

### 백엔드
- [ ] ERD 목록 조회 응답 시간 < 1초
- [ ] ERD 상세 조회 응답 시간 < 2초
- [ ] ERD 생성 시간 < 5초

### 프론트엔드
- [ ] ERD 목록 페이지 로드 시간 < 2초
- [ ] ERD 상세 페이지 로드 시간 < 3초
- [ ] Mermaid.js 렌더링 시간 < 2초
- [ ] 확대/축소/팬 동작 지연 없음

## 보안 테스트

- [ ] 인증되지 않은 사용자 접근 차단
- [ ] 다른 테넌트 ERD 접근 차단
- [ ] SQL Injection 방지
- [ ] XSS 방지

## 브라우저 호환성 테스트

- [ ] Chrome (최신 버전)
- [ ] Firefox (최신 버전)
- [ ] Safari (최신 버전)
- [ ] Edge (최신 버전)

## 모바일 테스트

- [ ] iOS Safari
- [ ] Android Chrome
- [ ] 반응형 레이아웃 동작
- [ ] 터치 제스처 동작 (확대/축소, 팬)

## 알려진 이슈 및 제한사항

1. **Mermaid.js 렌더링**
   - 매우 큰 ERD의 경우 렌더링 시간이 길어질 수 있음
   - 일부 복잡한 관계선은 렌더링되지 않을 수 있음

2. **확대/축소**
   - 확대/축소 범위: 50% ~ 300%
   - 매우 큰 ERD의 경우 성능 저하 가능

3. **필터링**
   - 필터링은 클라이언트 사이드에서만 동작
   - 서버 사이드 필터링은 향후 구현 예정

## 테스트 완료 기준

- [ ] 모든 백엔드 통합 테스트 통과
- [ ] 모든 프론트엔드 기능 수동 테스트 완료
- [ ] API 통합 테스트 완료
- [ ] 성능 테스트 기준 충족
- [ ] 보안 테스트 통과
- [ ] 브라우저 호환성 확인
- [ ] 모바일 테스트 완료

## 다음 단계

Week 4 완료 후:
- Week 5: 추가 기능 구현 또는 버그 수정
- 사용자 피드백 수집
- 성능 최적화
- 추가 테스트 케이스 작성

