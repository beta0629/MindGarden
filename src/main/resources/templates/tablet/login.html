<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MindGarden - 로그인</title>
    <link rel="stylesheet" th:href="@{/css/variables.css}">
    <link rel="stylesheet" th:href="@{/css/common.css}">
    <link rel="stylesheet" th:href="@{/css/tablet.css}">
    <link rel="stylesheet" th:href="@{/css/components.css}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="tablet-login-page">

    
    <div class="login-container">
        <!-- 로고 섹션 -->
        <div class="logo-section">
            <div class="logo-container">
                <div class="logo-icon">
                    <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
                        <circle cx="24" cy="24" r="20" fill="var(--primary-200)" stroke="var(--primary-400)" stroke-width="2"/>
                        <path d="M16 20C16 17.7909 17.7909 16 20 16H28C30.2091 16 32 17.7909 32 20V28C32 30.2091 30.2091 32 28 32H20C17.7909 32 16 30.2091 16 28V20Z" fill="var(--primary-300)"/>
                        <circle cx="24" cy="24" r="4" fill="var(--primary-500)"/>
                    </svg>
                </div>
                <h1 class="logo-text">MindGarden</h1>
                <p class="logo-subtitle">통합 상담관리 시스템</p>
            </div>
        </div>

        <!-- 로그인 폼 섹션 -->
        <div class="login-form-section">
            <div class="form-container">
                <h2 class="form-title">로그인</h2>
                <p class="form-subtitle">계정에 로그인하여 서비스를 이용하세요</p>
                
                <form id="loginForm" class="login-form" th:action="@{/api/auth/login}" method="post">
                    <div class="form-group">
                        <label for="email" class="form-label">이메일</label>
                        <div class="input-wrapper">
                            <div class="input-icon">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                    <path d="M2.5 5.83333C2.5 4.91286 3.24619 4.16667 4.16667 4.16667H15.8333C16.7538 4.16667 17.5 4.91286 17.5 5.83333V14.1667C17.5 15.0871 16.7538 15.8333 15.8333 15.8333H4.16667C3.24619 15.8333 2.5 15.0871 2.5 14.1667V5.83333Z" stroke="var(--secondary-400)" stroke-width="1.5"/>
                                    <path d="M17.5 5.83333L10 10.8333L2.5 5.83333" stroke="var(--secondary-400)" stroke-width="1.5"/>
                                </svg>
                            </div>
                            <input type="email" id="email" name="email" class="form-input" placeholder="이메일을 입력하세요" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="password" class="form-label">비밀번호</label>
                        <div class="input-wrapper">
                            <div class="input-icon">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                    <path d="M15 8.33333V6.66667C15 4.08934 12.9107 2 10.3333 2C7.756 2 5.66667 4.08934 5.66667 6.66667V8.33333" stroke="var(--secondary-400)" stroke-width="1.5"/>
                                    <rect x="3.33333" y="8.33333" width="14" height="9.66667" rx="1" stroke="var(--secondary-400)" stroke-width="1.5"/>
                                    <circle cx="10" cy="13" r="1" fill="var(--secondary-400)"/>
                                </svg>
                            </div>
                            <input type="password" id="password" name="password" class="form-input" placeholder="비밀번호를 입력하세요" required>
                            <button type="button" class="password-toggle" onclick="togglePassword()">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                    <path d="M10 4.16667C6.25 4.16667 3.33333 6.66667 2.5 10C3.33333 13.3333 6.25 15.8333 10 15.8333C13.75 15.8333 16.6667 13.3333 17.5 10C16.6667 6.66667 13.75 4.16667 10 4.16667Z" stroke="var(--secondary-400)" stroke-width="1.5"/>
                                    <circle cx="10" cy="10" r="2.5" stroke="var(--secondary-400)" stroke-width="1.5"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-options">
                        <label class="checkbox-wrapper">
                            <input type="checkbox" id="rememberMe" name="rememberMe">
                            <span class="checkmark"></span>
                            로그인 상태 유지
                        </label>
                        <a href="#" class="forgot-password">비밀번호 찾기</a>
                    </div>
                    
                    <button type="submit" class="login-button">
                        <span class="button-text">로그인</span>
                        <div class="button-icon">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <path d="M3.33333 10H16.6667M16.6667 10L11.6667 5M16.6667 10L11.6667 15" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                    </button>
                </form>
                
                <div class="divider">
                    <span>또는</span>
                </div>
                
                <div class="social-login">
                    <button class="social-button kakao" onclick="kakaoLogin()">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <path d="M10 2C5.58172 2 2 5.58172 2 10C2 14.4183 5.58172 18 10 18C14.4183 18 18 14.4183 18 10C18 5.58172 14.4183 2 10 2Z" fill="#FEE500"/>
                            <path d="M10 6C7.79086 6 6 7.79086 6 10C6 12.2091 7.79086 14 10 14C12.2091 14 14 12.2091 14 10C14 7.79086 12.2091 6 10 6Z" fill="#FEE500"/>
                        </svg>
                        카카오로 로그인
                    </button>
                    
                    <button class="social-button naver" onclick="naverLogin()">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <rect width="20" height="20" rx="2" fill="#03C75A"/>
                            <path d="M6 6L14 14M14 6L6 14" stroke="white" stroke-width="2"/>
                        </svg>
                        네이버로 로그인
                    </button>
                </div>
                
                <div class="signup-link">
                    <p>계정이 없으신가요? <a href="/tablet/register" class="link">회원가입</a></p>
                </div>
            </div>
        </div>
        
        <!-- 배경 장식 -->
        <div class="background-decoration">
            <div class="floating-shape shape-1"></div>
            <div class="floating-shape shape-2"></div>
            <div class="floating-shape shape-3"></div>
        </div>
    </div>

    <script th:src="@{/js/common/utils.js}"></script>
    <script th:src="@{/js/tablet/tablet.js}"></script>
    

    
    <script>
        // 비밀번호 표시/숨김 토글
        function togglePassword() {
            const passwordInput = document.getElementById('password');
            const toggleButton = document.querySelector('.password-toggle svg');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleButton.innerHTML = `
                    <path d="M2.5 5.83333C2.5 4.91286 3.24619 4.16667 4.16667 4.16667H15.8333C16.7538 4.16667 17.5 4.91286 17.5 5.83333V14.1667C17.5 15.0871 16.7538 15.8333 15.8333 15.8333H4.16667C3.24619 15.8333 2.5 15.0871 2.5 14.1667V5.83333Z" stroke="var(--secondary-400)" stroke-width="1.5"/>
                    <path d="M17.5 5.83333L10 10.8333L2.5 5.83333" stroke="var(--secondary-400)" stroke-width="1.5"/>
                    <line x1="2.5" y1="2.5" x2="17.5" y2="17.5" stroke="var(--accent-red)" stroke-width="1.5"/>
                `;
            } else {
                passwordInput.type = 'password';
                toggleButton.innerHTML = `
                    <path d="M10 4.16667C6.25 4.16667 3.33333 6.66667 2.5 10C3.33333 13.3333 6.25 15.8333 10 15.8333C13.75 15.8333 16.6667 13.3333 17.5 10C16.6667 6.66667 13.75 4.16667 10 4.16667Z" stroke="var(--secondary-400)" stroke-width="1.5"/>
                    <circle cx="10" cy="10" r="2.5" stroke="var(--secondary-400)" stroke-width="1.5"/>
                `;
            }
        }

        // 로그인 폼 제출 처리
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const loginData = {
                email: formData.get('email'),
                password: formData.get('password')
            };
            
            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(loginData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        // 로그인 성공 시 토큰 저장
                        localStorage.setItem('accessToken', result.data.token);
                        localStorage.setItem('refreshToken', result.data.refreshToken);
                        
                        // 태블릿 홈으로 리다이렉트
                        window.location.href = '/tablet/';
                    } else {
                        window.notification.error('로그인 실패', result.message, 5000);
                    }
                } else {
                    window.notification.error('로그인 실패', '로그인에 실패했습니다. 이메일과 비밀번호를 확인해주세요.', 5000);
                }
            } catch (error) {
                console.error('로그인 오류:', error);
                window.notification.error('오류 발생', '로그인 중 오류가 발생했습니다.', 5000);
            }
        });
        
        // 카카오 로그인
        async function kakaoLogin() {
            try {
                console.log('카카오 로그인 시작...');
                
                // 서버에서 OAuth2 설정 정보 가져오기
                const response = await fetch('/api/auth/config/oauth2');
                const config = await response.json();
                
                console.log('OAuth2 설정 정보:', config);
                
                // 카카오 OAuth2 인증 URL로 리다이렉트
                const kakaoAuthUrl = config.kakao.authUrl + "?" +
                    "client_id=" + config.kakao.clientId +
                    "&redirect_uri=" + encodeURIComponent(config.kakao.redirectUri) +
                    "&response_type=code" +
                    "&scope=profile_nickname,profile_image,account_email";
                
                console.log('생성된 카카오 인증 URL:', kakaoAuthUrl);
                console.log('리다이렉트 URI:', config.kakao.redirectUri);
                
                window.location.href = kakaoAuthUrl;
                
            } catch (error) {
                console.error('카카오 로그인 오류:', error);
                window.notification.error('카카오 로그인 오류', '카카오 로그인을 시작할 수 없습니다.', 5000);
            }
        }
        
        // 네이버 로그인
        async function naverLogin() {
            try {
                // 서버에서 OAuth2 설정 정보 가져오기
                const response = await fetch('/api/auth/config/oauth2');
                const config = await response.json();
                
                // 네이버 OAuth2 인증 URL로 리다이렉트
                const naverAuthUrl = config.naver.authUrl + "?" +
                    "client_id=" + config.naver.clientId +
                    "&redirect_uri=" + encodeURIComponent(config.naver.redirectUri) +
                    "&response_type=code" +
                    "&state=" + Math.random().toString(36).substr(2, 11);
                
                window.location.href = naverAuthUrl;
                
            } catch (error) {
                console.error('네이버 로그인 오류:', error);
                window.notification.error('네이버 로그인 오류', '네이버 로그인을 시작할 수 없습니다.', 5000);
            }
        }
    </script>
    
    <!-- 공통 알림 컴포넌트 -->
    <div th:replace="~{common/components/notification :: notification}"></div>
    
    <!-- 공통 알림 스크립트 -->
    <script th:replace="~{common/components/notification :: notification-script}"></script>
    
    <!-- 소셜 회원가입 모달 컴포넌트 -->
    <div th:replace="~{common/components/social-signup-modal :: social-signup-modal}"></div>
    
    <!-- 소셜 회원가입 모달 스크립트 -->
    <script th:replace="~{common/components/social-signup-modal :: social-signup-modal-script}"></script>
</body>
</html>
