# MindGarden 2.0: 소상공인 플랫폼 확장 계획

## 1. 비전 및 목표 (Vision & Goals)

- **타겟 고객:** 대한민국 내 소규모 자영업자 (태권도장, 각종 학원, 배달외식 업체, POS가 없는 서비스 업종 등)
- **핵심 가치 제안:** 복잡한 자체 시스템 없이 회원, 주문, 결제를 한 번에 관리할 수 있는 올인원(All-in-One) 솔루션 제공
- **주요 기능 방향:**
  - 다중 사업장 지원 (Multi-Tenancy)
  - 고객 관계 관리 (CRM)
  - 주문·예약·수강 관리
  - 중앙화된 결제·정산 (기존 ERP 시스템 확장)
  - 소비자/관리자 포털을 동일 플랫폼 내에서 운영

## 2. 기존 MindGarden 시스템 분석 (Current System Assessment)

- **아키텍처 개요:** Spring Boot 기반 백엔드 + React 프론트엔드(디자인 시스템
  v2.0 적용), ERP 모듈 중심의 상담 센터 프랜차이즈 모델(Branch 단위 사업장 관리)
- **주요 제공 기능:**
  - 상담 일정 관리 및 승인 흐름
  - ERP 기반 결제·정산·통계 기능
  - 공통 알림/푸시 시스템 (NotificationContext 연동)
  - 모바일 앱 세션/로그인 관리 (SessionManager, AsyncStorage 등)
  - 디자인 시스템 v2.0 (공통 UI 컴포넌트, CSS 변수 체계)
- **식별된 문제/기술 부채:**
  - 모바일 앱의 오래된 `JSESSIONID` 유지로 인한 인증 오류(403)
  - 공개 페이지(`/register`, `/forgot-password`)의 CSS 하드코딩/반응형 부족
  - `/api/auth/register` 미구현으로 인한 404, 401 오류 및 공용 알림 API 호출 이슈
  - 브랜치 코드 처리 로직의 일관성 부족 (소셜 회원가입 포함)
- **재사용·확장 기회:**
  - Branch/ERP 도메인 모델을 멀티테넌시 기본 틀로 전환 가능
  - 디자인 시스템 v2.0, NotificationContext, 결제/정산 모듈을 확장 플랫폼 코어로 재활용
  - SessionManager, SecurityConfig 개선 경험을 확장 아키텍처 보안 표준으로 활용

## 3. 제안 아키텍처 (Proposed Architecture)

- **멀티테넌시 전략:** 기존 Branch 구조를 기반으로 테넌트 식별자(Tenant ID)를
  도입하고, 공유 DB 내 테넌트 필드 분리 또는 스키마 분리를 검토
- **모듈형 서비스 설계:**
  - `코어 서비스(Core Services)`: 인증, 테넌트/사용자 관리, ERP 결제·정산,
    알림/푸시, 설정 관리
  - `업종별 모듈(Business Modules)`: 업종 특화 로직을 플러그인 형태로 확장
    (예: `Academy Module`, `Food Service Module`)
- **API 우선 접근:** REST/GraphQL API 레이어를 중심으로 웹 대시보드, 소비자 웹·모바일 앱, 파트너 시스템 연동을 지원

## 4. 데이터 모델 및 도메인 설계 (초안)

- `Tenant/Business`: 등록된 소상공인 사업장 (기존 Branch 모델 확장)
- `Branch/Outlet`: 다지점 사업장 지원 시 하위 조직 단위
- `Staff/Admin`: 각 테넌트·지점 관리 권한을 가진 내부 사용자
- `Customer`: 특정 테넌트에 소속된 외부 고객/회원
- `Product/Service`: 수강권, 메뉴 등 테넌트가 제공하는 상품/서비스
- `Order/Reservation`: 주문, 예약, 수강 신청 등 거래 정보
- `Payment/Settlement`: 중앙 ERP와 연계된 결제 및 정산 데이터

## 5. 이중 포털 경험 설계 (Dual Portal Experience)

- **소비자 포털:**
  - 서비스/상품 탐색, 예약·주문, 회원가입/로그인, 결제, 주문 내역 조회
  - 반응형 웹 및 향후 모바일 앱 연계 고려
- **관리자 포털:**
  - 테넌트 등록·설정, 직원/권한 관리
  - 회원·주문·결제 현황 대시보드, 재고/수강 관리, 프로모션·알림 설정
  - ERP 기반 공통 정산 뷰 및 분석 리포트 제공
- **공통 UX 고려:** 동일 플랫폼 내에서 브랜드 일관성 유지, 역할 기반 라우팅·권한 관리

## 6. 중앙화 데이터 코어 및 성능 전략

- **PL/SQL 기반 데이터 처리 최적화:** 고부하 집계·정산 작업을 데이터베이스
  레벨(Package/Procedure)에서 수행하여 처리 속도를 높이고 API 서버 부하를 경감
- **코드 테이블 한국어 필드 일관성:** 공통 코드 테이블에 코드 값과 함께 한글
  필드를 기본으로 포함하여 다국어/로컬라이제이션 요구 사항을 충족
- **데이터 일관성 관리:** ERP와 통합된 트랜잭션 처리 시점을 표준화하고,
  PL/SQL 작업과 애플리케이션 레이어 간의 데이터 동기 전략을 수립

## 7. 단계별 실행 로드맵 (MVP 우선)

- **1단계: 기반 구축 및 MVP (타겟: 학원)**
  - 테넌트 온보딩 및 Branch 구조 정비, 역할·권한 관리 강화
  - 학원용 CRM(회원 등록, 반 배정, 출결, 수강료 청구) 및 소비자 예약·결제 흐름 구현
  - 80/20 제품 전략 수립: 공통 5대 흐름 표준화 + 규칙 기반 설정으로 커스터마이징 최소화
  - 관리자/소비자 포털의 핵심 화면 제공 및 기존 ERP 결제 연동
- **2단계: 기능 확장 (타겟: 소규모 요식업)**
  - 메뉴/상품 관리, 주문 접수·처리(포장/배달) 기능 추가
  - 주방/매장 실시간 주문 현황, 소비자 주문 UX 개선
- **3단계: 플랫폼 고도화**
  - 분석 대시보드, 마케팅/알림 자동화, 충성도 프로그램
  - 외부 서비스(배달 플랫폼, 회계/세무, 메시지 API)와의 연동 확대

## 8. 주요 기술 고려사항 및 리스크

- **확장성:** 테넌트 증가 대비 수평 확장 구조, 테넌트별 리소스 한도 관리
- **보안 및 규제 준수:** 테넌트/사용자 데이터 격리, 접근 제어, 로그 감사, 국내 개인정보보호법 준수
- **로그 격리:** Logback MDC 기반 `tenantId`/`branchId` 강제 주입, ELK/OpenSearch 인덱스를 테넌트 단위로 분리, 민감 필드 마스킹 및 보존 기간 정책화
- **결제 게이트웨이:** 반복 결제, 가상계좌, 간편결제 등 국내 결제 수단을 지원 가능한 PG 선정
- **운영/유지보수:** 공통 코드·디자인 시스템 재사용, 설정 기반 커스터마이징, 자동화된 테스트·배포 파이프라인 확보
- **코어 데이터 성능:** PL/SQL 사용 시 코드 품질 관리, DB 락/경쟁 상태 감시, 장애 대응 절차 마련

## 9. Supporting Documents & Alignment

- `ARCHITECTURE_OVERVIEW.md`: 서비스·포털 구성, 멀티테넌시 구현, 배포/보안 전략 상세 설명
- `DATA_CORE_AND_PL_SQL.md`: 데이터 모델 원칙, PL/SQL 정산/집계 배치, 코드 한글 필드 정책, 장애 대응 포함
- 두 문서는 본 확장 계획의 1~8장 내용을 구체화하며, MindGarden 기존 역량과 신규 플랫폼 병행 운영 전략에 정합하게 정리됨

## 10. Phase 1 (학원) Next Steps

1. 멀티테넌시 구현 세부 설계 확정 (TenantContext, Repository 추상화, 마이그레이션 시나리오)
2. 학원용 관리자/소비자 플로우 UX 프로토타입 작성 및 검증
3. 정산/집계 PL/SQL 패키지 시퀀스 정의와 배치 스케줄 설계
4. 공통 코드 한글 필드 적용을 위한 코드 관리 UI 및 API 요구 사항 명세
5. QA 전략 수립: E2E 시나리오(수강 신청→결제→정산), 성능/회귀 테스트 계획
6. Phase 1 출시 범위 확정 후 개발 일정/자원 계획 수립

## 11. 추가 개발 계획 (후속 과제)

### 11.1 운영 자동화·안정화
- 무중단 배포 전략 도입 (Blue/Green, Canary) 및 배포 헬스체크 자동화
- 세션/토큰 모니터링 대시보드화, 이상 탐지 시 자동 알림 체계 구축
- PL/SQL 정산·통계 배치 상태를 KPI와 연동하여 실시간 감시
- 요금제 운영 표준화: 기본 요금제(Starter/Standard/Premium) 한도 정의, 애드온 패키지(`AI Advanced Pack`, `HQ Analytics Pack`, `Security Compliance Pack`) 관리 프로세스 수립

### 11.2 업종 확장 준비
- 학원 외 업종(미용, 서비스, 배달 등)의 **공통 5대 흐름** 정의 및 모듈 설계
- POS/현장 결제 데이터와 중앙 ERP 정산의 통합 인터페이스 마련
- HQ 정책 엔진 고도화: 로열티, 프로모션, 공지 등 본사 통제 기능 강화
- 웰니스/콘텐츠 AI 고도화: 업종별 맞춤 컨텐츠 생성, 학습 데이터 관리 체계 마련

### 11.3 고객 경험 및 AI 강화
- 출결/스케줄 모바일 앱 UX 개선, 푸시 알림·오프라인 모드 지원
- AI 추천/이탈 예측 MVP: 학원 데이터를 기반으로 운영 인사이트 제공
- 소비자 포털의 예약/결제 AB 테스트, 접근성·반응형 개선
- 운영 로그 요약 및 알림 자동화(Slack/대시보드)
- 내부 운영 지원 챗봇 PoC → 단계별 고객 FAQ 챗봇 확장
- AI 인사이트 대시보드(정산/예약 요약, 리포트 자동 생성)
- 테넌트별 AI 사용량·과금 체계 구축: `tenant_ai_subscription`, `tenant_ai_usage_daily`, `tenant_ai_invoice_monthly` 모델 도입 및 PL/SQL 청구 배치 구현, MindGarden 수수료(30~40%/고급 50%) 정책 반영
- 온보딩 체크리스트 분리: 테넌트 개별 설정(모델 선택, API 키, 한도/알림)과 MindGarden 공통 정책(가격표, 수수료율, 보안 표준, 침해 대응) 구분 관리

### 11.4 DevOps 및 품질
- SecurityAlert/AuditLog 시각화 대시보드 구축, SIEM 연동
- 자동화 테스트 고도화: Spin-up 환경에서 E2E·성능·회귀 테스트 주기화
- API 문서(Swagger/OpenAPI) 자동 배포 및 형상 관리 체계 확립
- API Gateway Rate Limiting, 서드파티 연동 승인 워크플로우, GitOps 기반 IaC 운영

### 11.5 확장 대비 기반 체계
- Observability 통합(메트릭·로그·트레이싱) 및 테넌트별 KPI 대시보드
- Kafka/EventBridge 기반 이벤트 스트림과 DLQ/재처리 정책 수립
- DR/백업/복구 시나리오 정기 검증, 다국어·다국가(i18n, 환율/세금) 대비 로드맵
- 데이터 레이크/BI 파이프라인 도입, 테넌트/HQ용 분석 리포트 자동화
- 운영 데이터 테이블/모듈: `tenant_ai_subscription`, `tenant_ai_usage_daily`, `tenant_ai_invoice_monthly`, `pricing_plan`, `tenant_role`, `feature_flag` 등

### 11.6 운영 거버넌스 & 입점사 관리 포털
- MVP: 테넌트 온보딩 체크리스트, 요금제·애드온 승인, 기본 관제 대시보드
- V2: 권한/보안 감사 모듈, Runbook·알림 연계, AI 사용량·청구 리포트
- V3: Workflow 엔진 연동, 외부 시스템 커넥터(ERP, 고객지원, 문서 관리), 자동화 승인 루프
- 운영 데이터 테이블: `tenant_onboarding_task`, `pricing_change_request`, `feature_flag_audit`, `incident_report`, `operator_notification` 등으로 변경 이력 추적

### 11.7 내부 운영 모바일 앱 (필수 메뉴)
- Phase A: React Native 기반 MVP (알림 승인, 주요 KPI 뷰, 테넌트 온보딩 승인)
- Phase B: 배포 상태 모니터링, 배치 재시작 요청, AI 사용량 경보 처리
- Phase C: 오프라인 사고 보고, 현장 이슈 트래킹, 운영 챗봇 연동
- 보안 정책: MDM 등록 기기 + 2차 인증(OTP/PUSH), 데이터 암호화 저장, 분실 기기 원격 잠금/삭제

### 11.8 Zero-Touch Onboarding & Billing Automation
- Phase 1: 가입→결제→테넌트 생성 자동화 (요금제/역할/브랜딩 기본값, 샘플 데이터, API Key 발급)
- Phase 2: 결제 실패 재시도·자동 알림, AI 사용량·요금 과금 자동 트리거, 세금계산서 발행 연동
- Phase 3: Workflow Engine 기반 승인·롤백 규칙, 이벤트 스트림을 통한 실시간 관제와 자동 티켓 생성
- 목표: “결제하면 즉시 사용” 경험을 제공하며, 운영 개입 없는 SaaS 활성화 달성

### 11.9 최소 입력(로그인 제외) 자동화 로드맵
- Step 1: 업종/규모 선택만으로 요금제·권한·메뉴 자동 매핑 (템플릿 확장, Feature Flag 연동)
- Step 2: 최초 결제 시 정기 과금·세금 정보 저장, 이후 결제·세금계산서·영수증 자동 처리
- Step 3: 샘플 데이터/AI 초안/체크리스트 제공으로 추가 입력 없이 즉시 운영 가능하게 구성
- Step 4: 운영 포털 원클릭 승인 및 이벤트 기반 자동 롤백/제한으로 완전 무인화 달성
- KPI: 가입→활성화까지 평균 수동 입력 필드 0개(로그인 제외), 온보딩 소요 시간 5분 이내

### 11.10 컴포넌트 기반 모듈화 & 애드온 과금 시스템
- **목표**: 현재 MindGarden의 섹션별 컴포넌트 모듈화 강점을 살려, 입점 사용자가 DB에 등록되어 필요한 컴포넌트만 선택하여 사용하고, 기본 세팅 외 컴포넌트는 애드온 방식으로 과금하는 시스템 구축
- **컴포넌트 카탈로그 설계**:
  - `component_catalog`: 컴포넌트 메타데이터 (상담, 예약, 결제, 정산, 알림, CRM, 출결, 통계 등)
  - `tenant_component`: 테넌트별 활성화된 컴포넌트 목록 및 활성화 이력
  - `component_feature`: 컴포넌트별 제공 기능 및 의존성 정의
  - `component_pricing`: 컴포넌트별 과금 정책 (기본 포함/애드온, 월정액/Usage 기반)
- **온보딩 시 컴포넌트 선택**:
  - 테넌트 온보딩 시 기본 컴포넌트 세트(상담, 예약, 결제, 기본 알림) + 선택 애드온 컴포넌트 선택 UI 제공
  - 컴포넌트별 기능 설명, 가격 정보, 의존성 안내 제공
  - 선택한 컴포넌트에 따라 메뉴 구조, 권한 템플릿, Feature Flag 자동 설정
- **컴포넌트 활성화/비활성화**:
  - 테넌트 대시보드에서 "내 컴포넌트" 관리 페이지 제공
  - 컴포넌트 활성화/비활성화 시 즉시 적용 (Feature Flag 기반)
  - 컴포넌트 비활성화 시 관련 데이터 보존 정책 적용 (보관 기간, 접근 제한)
- **컴포넌트별 과금 시스템**:
  - 기본 컴포넌트: 기본 요금제에 포함 (Starter/Standard/Premium)
  - 애드온 컴포넌트: 선택 시 월정액 또는 Usage 기반 과금
  - 컴포넌트별 사용량 추적: API 호출 수, 사용자 수, 데이터 저장량 등
  - 월별 컴포넌트 사용량 리포트 및 청구서에 컴포넌트 단위 내역 표시
- **컴포넌트 의존성 관리**:
  - 필수 컴포넌트 (상담, 예약): 비활성화 불가
  - 선택 컴포넌트 (고급 통계, AI 인사이트, 외부 연동 등): 애드온으로 제공
  - 컴포넌트 간 의존성 검증 (예: 통계 컴포넌트는 결제 컴포넌트 필수)
  - 의존성 충돌 방지 및 활성화 전 검증 로직 구현
- **운영 포털 컴포넌트 관리**:
  - 컴포넌트 카탈로그 관리 UI (등록, 수정, 버전 관리)
  - 테넌트별 컴포넌트 활성화 현황 대시보드
  - 컴포넌트별 사용량 통계 및 수익 분석
  - 컴포넌트 업그레이드/마이그레이션 계획 및 실행
- **기술적 구현**:
  - Feature Flag 기반 컴포넌트 활성화 제어 (`component_{component_code}_enabled`)
  - 컴포넌트별 라우팅 및 메뉴 동적 생성
  - 컴포넌트별 API 엔드포인트 접근 제어 (권한 검증)
  - 컴포넌트별 사용량 메트릭 수집 및 청구 배치 연동
- **예상 효과**:
  - 테넌트별 맞춤형 서비스 제공 (필요한 기능만 선택)
  - 유연한 가격 정책 (기본 + 선택 과금 모델)
  - 컴포넌트 단위 개발 및 배포 용이성
  - 업종별 확장 시 컴포넌트 조합으로 빠른 대응