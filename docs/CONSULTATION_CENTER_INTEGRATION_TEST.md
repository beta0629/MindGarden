# 🏥 상담센터 운영 통합테스트 시나리오

## 📋 테스트 개요

**목적**: 상담센터 전체 업무 프로세스의 통합 테스트  
**범위**: 내담자 등록부터 상담 완료, 환불 처리까지 전 과정  
**환경**: 로컬 개발 환경 (시뮬레이션 모드)  

---

## 🎯 **핵심 업무 프로세스 테스트**

### **시나리오 1: 신규 내담자 상담 전체 프로세스**

#### **1단계: 내담자 등록 및 매핑 생성**
```
👤 내담자 등록
- 이름: 통합테스트내담자001
- 전화번호: 010-1111-2222
- 이메일: integration-test@mindgarden.com

🔗 상담사-내담자 매핑 생성
- 상담사: 김선희 (활성 상담사)
- 패키지: 기본 10회기 패키지 (500,000원)
- 결제 방법: 신용카드
- 상태: ACTIVE
```

#### **2단계: 상담 스케줄 등록**
```
📅 스케줄 생성
- 날짜: 오늘 + 3일
- 시간: 14:00-14:50
- 상담 유형: 개인상담
- 상태: BOOKED → CONFIRMED

📱 알림 발송 확인
- 상담 확정 알림톡 발송
- 1시간 전 리마인더 (예약)
```

#### **3단계: 상담 진행 및 완료**
```
✅ 상담 완료 처리
- 스케줄 상태: COMPLETED
- 매핑 회기 차감: remainingSessions - 1
- 상담 기록 작성 (선택)
```

#### **4단계: 환불 처리 (선택적)**
```
💰 환불 요청 시나리오
- 환불 사유: "개인 사정으로 인한 중단"
- 환불 회기: 남은 회기 전체
- 환불 금액: 비례 계산
- 스케줄 자동 취소
- ERP 연동 확인
- 환불 완료 알림톡 발송
```

---

### **시나리오 2: 상담사 변경 프로세스**

#### **1단계: 상담사 변경 요청**
```
🔄 상담사 변경
- 기존: 김선희
- 신규: 김선희2
- 사유: "전문분야 매칭"
- 남은 회기: 유지
```

#### **2단계: 매핑 및 스케줄 이전**
```
📋 데이터 이전 확인
- 기존 매핑: TERMINATED
- 신규 매핑: ACTIVE (동일한 회기 수)
- 예정 스케줄: 새로운 상담사로 이전
- 이전 알림 발송
```

---

### **시나리오 3: 상담사 삭제 및 이전 프로세스**

#### **1단계: 상담사 삭제 상태 확인**
```
🔍 삭제 가능 여부 체크
- 활성 매핑: 있음
- 예정 스케줄: 있음
- 결과: 이전 필요
```

#### **2단계: 상담사 이전 삭제**
```
🔄 이전 삭제 처리
- 이전 대상: 다른 활성 상담사
- 매핑 이전: 모든 활성 매핑
- 스케줄 이전: 모든 예정 스케줄
- 상담사 비활성화
```

---

### **시나리오 4: 내담자 삭제 프로세스**

#### **1단계: 내담자 삭제 상태 확인**
```
🔍 삭제 가능 여부 체크
- 남은 회기: 있음
- 예정 스케줄: 있음
- 결과: 환불 처리 필요
```

#### **2단계: 환불 후 삭제**
```
💰 환불 처리
- 모든 활성 매핑 환불
- 관련 스케줄 취소
- ERP 연동 확인
- 환불 완료 알림

🗑️ 안전한 삭제
- 내담자 비활성화
- 데이터 보관 (법적 요구사항)
```

---

## 🧪 **기술적 통합 테스트**

### **알림 시스템 통합 테스트**
```bash
# 1. 서비스 상태 확인
curl "http://localhost:8080/api/test/notification/alimtalk/status"

# 2. 상담 확정 알림
curl -X POST "http://localhost:8080/api/test/notification/consultation-confirmed" \
  -H "Content-Type: application/json" \
  -d '{
    "userId": [내담자ID],
    "consultantName": "김선희",
    "consultationDate": "2025-09-20",
    "consultationTime": "14:00"
  }'

# 3. 환불 완료 알림
curl -X POST "http://localhost:8080/api/test/notification/refund-completed" \
  -H "Content-Type: application/json" \
  -d '{
    "userId": [내담자ID],
    "refundSessions": 5,
    "refundAmount": 250000
  }'

# 4. 모든 알림 방식 테스트
curl -X POST "http://localhost:8080/api/test/notification/all-methods" \
  -H "Content-Type: application/json" \
  -d '{
    "userId": [내담자ID],
    "message": "통합테스트"
  }'
```

### **환불 시스템 통합 테스트**
```bash
# 1. 환불 통계 확인
curl "http://localhost:8080/api/admin/refund-statistics?period=month"

# 2. 환불 이력 확인
curl "http://localhost:8080/api/admin/refund-history?page=0&size=10"

# 3. ERP 동기화 상태
curl "http://localhost:8080/api/admin/erp-sync-status"
```

---

## 📊 **성공 기준**

### **기능적 성공 기준**
- ✅ 모든 API 응답 `success: true`
- ✅ 데이터 일관성 유지 (매핑, 스케줄, 회기)
- ✅ 알림 발송 성공 (시뮬레이션 모드)
- ✅ ERP 연동 성공 (모의 데이터)

### **성능적 성공 기준**
- ✅ API 응답 시간 < 2초
- ✅ 데이터베이스 트랜잭션 성공
- ✅ 메모리 누수 없음
- ✅ 로그 정상 기록

### **보안적 성공 기준**
- ✅ 개인정보 마스킹 확인
- ✅ API 키 노출 없음
- ✅ 시뮬레이션 모드 정상 동작
- ✅ 권한 검사 통과

---

## 🎯 **다음 단계**

### **1. 통합테스트 실행**
- 각 시나리오별 단계적 테스트
- 성공/실패 케이스 모두 확인
- 로그 분석 및 문제점 파악

### **2. 사용자 수락 테스트 (UAT)**
- 실제 상담센터 업무 담당자와 테스트
- 업무 프로세스 적합성 확인
- UI/UX 사용성 평가

### **3. 성능 테스트**
- 동시 사용자 부하 테스트
- 대량 데이터 처리 테스트
- 알림 발송 성능 테스트

### **4. 실제 운영 준비**
- 카카오 알림톡 API 키 발급
- 템플릿 승인 신청
- 운영 환경 배포

**상담센터 운영에 필요한 모든 개발이 완료되었습니다!** 🎉

이제 **통합테스트 → 사용자 수락테스트 → 운영 배포** 단계만 남았습니다! 🚀
