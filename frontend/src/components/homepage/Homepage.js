import React, { useEffect, useState } from 'react';
import { useNavigate } from 'react-router-dom';
import CommonPageTemplate from '../common/CommonPageTemplate';
import SimpleHeader from '../layout/SimpleHeader';
import TabletBottomNavigation from '../layout/TabletBottomNavigation';
import { HOMEPAGE_CONSTANTS } from '../../constants/css-variables';
import { useSession } from '../../contexts/SessionContext';
import { getDashboardPath } from '../../utils/session';
import notificationManager from '../../utils/notification';
import '../../styles/main.css';
import './Homepage.css';

const TabletHomepage = () => {
  const navigate = useNavigate();
  const { user, logout } = useSession();
  const [isLoaded, setIsLoaded] = useState(false);
  const [isMenuOpen, setIsMenuOpen] = useState(false);
  const [isProfileMenuOpen, setIsProfileMenuOpen] = useState(false);

  useEffect(() => {
    console.log('üè† TabletHomepage ÎßàÏö¥Ìä∏Îê®');
    console.log('üìç ÌòÑÏû¨ Í≤ΩÎ°ú:', window.location.pathname);
    console.log('üîó ÌòÑÏû¨ URL:', window.location.href);
    
    // ÌéòÏù¥ÏßÄ Î°úÎî© Ïï†ÎãàÎ©îÏù¥ÏÖò ÏãúÏûë
    const timer = setTimeout(() => {
      setIsLoaded(true);
      console.log('üì± ÌÖåÎ∏îÎ¶ø ÌôàÌéòÏù¥ÏßÄ Ïï†ÎãàÎ©îÏù¥ÏÖò ÏãúÏûë');
    }, 100);
    
    return () => {
      console.log('üè† TabletHomepage Ïñ∏ÎßàÏö¥Ìä∏Îê®');
      clearTimeout(timer);
    };
  }, []);

  const handleLogin = () => {
    console.log('üîê Î°úÍ∑∏Ïù∏ Î≤ÑÌäº ÌÅ¥Î¶≠Îê®');
    navigate('/login');
  };

  const handleRegister = () => {
    console.log('üìù ÌöåÏõêÍ∞ÄÏûÖ Î≤ÑÌäº ÌÅ¥Î¶≠Îê®');
    navigate('/register');
  };

  const handleHamburgerToggle = () => {
    const { MESSAGES } = HOMEPAGE_CONSTANTS;
    console.log('üçî ÌñÑÎ≤ÑÍ±∞ Î©îÎâ¥ ÌÜ†Í∏Ä');
    
    setIsMenuOpen(prev => {
      const newState = !prev;
      notificationManager.info(newState ? MESSAGES.MENU_OPENED : MESSAGES.MENU_CLOSED);
      return newState;
    });
  };

  const handleProfileClick = () => {
    const { MESSAGES } = HOMEPAGE_CONSTANTS;
    console.log('üë§ ÌîÑÎ°úÌïÑ ÌÅ¥Î¶≠');
    
    if (user) {
      // Î°úÍ∑∏Ïù∏Îêú ÏÇ¨Ïö©Ïûê: ÌîÑÎ°úÌïÑ Î©îÎâ¥ ÌÜ†Í∏Ä
      setIsProfileMenuOpen(prev => {
        const newState = !prev;
        notificationManager.info(newState ? MESSAGES.PROFILE_OPENED : MESSAGES.PROFILE_CLOSED);
        return newState;
      });
    } else {
      // Î°úÍ∑∏Ïù∏ÎêòÏßÄ ÏïäÏùÄ ÏÇ¨Ïö©Ïûê: Î°úÍ∑∏Ïù∏ ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô
      navigate('/login');
    }
  };

  const handleMenuClick = (menuItem) => {
    const { MENU_ITEMS } = HOMEPAGE_CONSTANTS;
    console.log('Î©îÎâ¥ ÌÅ¥Î¶≠:', menuItem);
    
    setIsMenuOpen(false);
    
    switch (menuItem) {
      case MENU_ITEMS.HOME:
        navigate('/');
        break;
      case MENU_ITEMS.LOGIN:
        navigate('/login');
        break;
      case MENU_ITEMS.REGISTER:
        navigate('/register');
        break;
      case MENU_ITEMS.ABOUT:
        navigate('/about');
        break;
      case MENU_ITEMS.SERVICES:
        navigate('/services');
        break;
      case MENU_ITEMS.CONTACT:
        navigate('/contact');
        break;
      default:
        console.log('Ïïå Ïàò ÏóÜÎäî Î©îÎâ¥ Ìï≠Î™©:', menuItem);
    }
  };

  const handleProfileMenuClick = async (menuItem) => {
    const { PROFILE_MENU_ITEMS, MESSAGES } = HOMEPAGE_CONSTANTS;
    console.log('ÌîÑÎ°úÌïÑ Î©îÎâ¥ ÌÅ¥Î¶≠:', menuItem);
    
    setIsProfileMenuOpen(false);
    
    switch (menuItem) {
      case PROFILE_MENU_ITEMS.DASHBOARD:
        // ÏÇ¨Ïö©Ïûê Ïó≠Ìï†Ïóê Îî∞Î•∏ ÎåÄÏãúÎ≥¥ÎìúÎ°ú Ïù¥Îèô
        const dashboardPath = user?.role ? getDashboardPath(user.role) : '/dashboard';
        navigate(dashboardPath);
        break;
      case PROFILE_MENU_ITEMS.PROFILE:
        navigate('/mypage');
        break;
      case PROFILE_MENU_ITEMS.SETTINGS:
        navigate('/settings');
        break;
      case PROFILE_MENU_ITEMS.LOGOUT:
        try {
          await logout();
          notificationManager.success(MESSAGES.LOGOUT_SUCCESS);
          navigate('/');
        } catch (error) {
          console.error('Î°úÍ∑∏ÏïÑÏõÉ Ïã§Ìå®:', error);
          notificationManager.error(MESSAGES.LOGOUT_ERROR);
        }
        break;
      default:
        console.log('Ïïå Ïàò ÏóÜÎäî ÌîÑÎ°úÌïÑ Î©îÎâ¥ Ìï≠Î™©:', menuItem);
    }
  };

  const handleOverlayClick = () => {
    setIsMenuOpen(false);
    setIsProfileMenuOpen(false);
  };

  return (
    <CommonPageTemplate 
      title="ÎßàÏù∏ÎìúÍ∞ÄÎì† - ÎßàÏùåÏùò Ï†ïÏõêÏùÑ Í∞ÄÍæ∏Îäî ÏÉÅÎã¥ ÏÑúÎπÑÏä§"
      description="Ï†ÑÎ¨∏ ÏÉÅÎã¥ÏÇ¨ÏôÄ Ìï®Íªò ÎßàÏùåÏùò ÌèâÌôîÎ•º Ï∞æÏïÑÎ≥¥ÏÑ∏Ïöî. Ïñ∏Ï†ú Ïñ¥ÎîîÏÑúÎÇò Ìé∏Î¶¨ÌïòÍ≤å ÏÉÅÎã¥ÏùÑ Î∞õÏùÑ Ïàò ÏûàÏäµÎãàÎã§."
      bodyClass="tablet-page"
    >
      <div className="tablet-homepage tablet-page">
        {/* Í≥µÌÜµ Ìó§Îçî */}
        <SimpleHeader 
          onHamburgerToggle={handleHamburgerToggle}
          onProfileClick={handleProfileClick}
        />
        
        {/* ÌñÑÎ≤ÑÍ±∞ Î©îÎâ¥ */}
        {isMenuOpen && (
          <div className="hamburger-menu-overlay" onClick={handleOverlayClick}>
            <div className="hamburger-menu" onClick={(e) => e.stopPropagation()}>
              <div className="hamburger-menu-header">
                <h3>Î©îÎâ¥</h3>
                <button 
                  className="hamburger-menu-close"
                  onClick={() => setIsMenuOpen(false)}
                >
                  <i className="bi bi-x"></i>
                </button>
              </div>
              <div className="hamburger-menu-content">
                <button 
                  className="hamburger-menu-item"
                  onClick={() => handleMenuClick(HOMEPAGE_CONSTANTS.MENU_ITEMS.HOME)}
                >
                  <i className="bi bi-house"></i>
                  Ìôà
                </button>
                <button 
                  className="hamburger-menu-item"
                  onClick={() => handleMenuClick(HOMEPAGE_CONSTANTS.MENU_ITEMS.ABOUT)}
                >
                  <i className="bi bi-info-circle"></i>
                  ÏÜåÍ∞ú
                </button>
                <button 
                  className="hamburger-menu-item"
                  onClick={() => handleMenuClick(HOMEPAGE_CONSTANTS.MENU_ITEMS.SERVICES)}
                >
                  <i className="bi bi-heart"></i>
                  ÏÑúÎπÑÏä§
                </button>
                <button 
                  className="hamburger-menu-item"
                  onClick={() => handleMenuClick(HOMEPAGE_CONSTANTS.MENU_ITEMS.CONTACT)}
                >
                  <i className="bi bi-telephone"></i>
                  Î¨∏Ïùò
                </button>
                {!user && (
                  <>
                    <button 
                      className="hamburger-menu-item"
                      onClick={() => handleMenuClick(HOMEPAGE_CONSTANTS.MENU_ITEMS.LOGIN)}
                    >
                      <i className="bi bi-box-arrow-in-right"></i>
                      Î°úÍ∑∏Ïù∏
                    </button>
                    <button 
                      className="hamburger-menu-item"
                      onClick={() => handleMenuClick(HOMEPAGE_CONSTANTS.MENU_ITEMS.REGISTER)}
                    >
                      <i className="bi bi-person-plus"></i>
                      ÌöåÏõêÍ∞ÄÏûÖ
                    </button>
                  </>
                )}
              </div>
            </div>
          </div>
        )}
        
        {/* ÌîÑÎ°úÌïÑ Î©îÎâ¥ */}
        {isProfileMenuOpen && user && (
          <div className="profile-menu-overlay" onClick={handleOverlayClick}>
            <div className="profile-menu" onClick={(e) => e.stopPropagation()}>
              <div className="profile-menu-header">
                <div className="profile-menu-user">
                  <div className="profile-menu-avatar">
                    {user.profileImageUrl ? (
                      <img src={user.profileImageUrl} alt={user.name} />
                    ) : (
                      <i className="bi bi-person-circle"></i>
                    )}
                  </div>
                  <div className="profile-menu-info">
                    <h4>{user.name}</h4>
                    <p>{user.email}</p>
                  </div>
                </div>
                <button 
                  className="profile-menu-close"
                  onClick={() => setIsProfileMenuOpen(false)}
                >
                  <i className="bi bi-x"></i>
                </button>
              </div>
              <div className="profile-menu-content">
                <button 
                  className="profile-menu-item"
                  onClick={() => handleProfileMenuClick(HOMEPAGE_CONSTANTS.PROFILE_MENU_ITEMS.DASHBOARD)}
                >
                  <i className="bi bi-speedometer2"></i>
                  ÎåÄÏãúÎ≥¥Îìú
                </button>
                <button 
                  className="profile-menu-item"
                  onClick={() => handleProfileMenuClick(HOMEPAGE_CONSTANTS.PROFILE_MENU_ITEMS.PROFILE)}
                >
                  <i className="bi bi-person"></i>
                  ÌîÑÎ°úÌïÑ
                </button>
                <button 
                  className="profile-menu-item"
                  onClick={() => handleProfileMenuClick(HOMEPAGE_CONSTANTS.PROFILE_MENU_ITEMS.SETTINGS)}
                >
                  <i className="bi bi-gear"></i>
                  ÏÑ§Ï†ï
                </button>
                <button 
                  className="profile-menu-item profile-menu-logout"
                  onClick={() => handleProfileMenuClick(HOMEPAGE_CONSTANTS.PROFILE_MENU_ITEMS.LOGOUT)}
                >
                  <i className="bi bi-box-arrow-right"></i>
                  Î°úÍ∑∏ÏïÑÏõÉ
                </button>
              </div>
            </div>
          </div>
        )}
        
        <main className="tablet-main">
          <div className="tablet-container">
            <div className={`hero-section-mobile ${isLoaded ? 'loaded' : ''}`}>
              {/* Î∞∞Í≤Ω Ïû•Ïãù */}
              <div style={{
                position: 'absolute',
                top: '-50%',
                right: '-20%',
                width: '300px',
                height: '300px',
                background: 'rgba(255, 255, 255, 0.1)',
                borderRadius: '50%',
                filter: 'blur(100px)'
              }} />
              <div style={{
                position: 'absolute',
                bottom: '-30%',
                left: '-10%',
                width: '200px',
                height: '200px',
                background: 'rgba(255, 255, 255, 0.08)',
                borderRadius: '50%',
                filter: 'blur(80px)'
              }} />
              
              <div style={{ position: 'relative', zIndex: 2 }}>
                <div style={{
                  display: 'inline-block',
                  padding: '8px 24px',
                  backgroundColor: 'rgba(255, 255, 255, 0.2)',
                  borderRadius: '50px',
                  marginBottom: '24px',
                  backdropFilter: 'blur(10px)',
                  border: '1px solid rgba(255, 255, 255, 0.3)'
                }}>
                  <span style={{
                    fontSize: '14px',
                    fontWeight: '600',
                    color: 'rgba(255, 255, 255, 0.95)',
                    fontFamily: "'Noto Sans KR', 'Malgun Gothic', 'ÎßëÏùÄ Í≥†Îîï', sans-serif"
                  }}>
                    üåø Ï†ÑÎ¨∏ Ïã¨Î¶¨ÏÉÅÎã¥ ÌîåÎû´Ìèº
                  </span>
                </div>
                
                <h1 className="hero-title-mobile">
                  ÎßàÏùåÏùò ÌèâÌôîÎ•º<br />Ï∞æÏïÑÍ∞ÄÎäî Ïó¨Ï†ï
                </h1>
                
                <p className="hero-subtitle-mobile">
                  Ï†ÑÎ¨∏ ÏÉÅÎã¥ÏÇ¨ÏôÄ Ìï®Íªò ÏïàÏ†ÑÌïòÍ≥† Ìé∏ÏïàÌïú ÌôòÍ≤ΩÏóêÏÑú<br />
                  ÎãπÏã†ÎßåÏùò ÏÜçÎèÑÎ°ú ÎßàÏùåÏùÑ ÎèåÎ≥¥ÏÑ∏Ïöî
                </p>
                
                {!user && (
                  <div className="hero-buttons-mobile">
                    <button className="hero-btn hero-btn-primary" onClick={handleLogin}>
                      <i className="bi bi-box-arrow-in-right"></i>
                      Î°úÍ∑∏Ïù∏
                    </button>
                    <button className="hero-btn hero-btn-secondary" onClick={handleRegister}>
                      <i className="bi bi-person-plus"></i>
                      ÌöåÏõêÍ∞ÄÏûÖ
                    </button>
                  </div>
                )}
              </div>
            </div>


            <div className={`services-section-mobile ${isLoaded ? 'loaded' : ''}`}>
              <div style={{
                textAlign: 'center',
                marginBottom: '60px'
              }}>
                <h2 className="services-title-mobile">
                  Ï†ÑÎ¨∏Ï†ÅÏù¥Í≥† ÏïàÏ†ÑÌïú ÏÉÅÎã¥ ÏÑúÎπÑÏä§
                </h2>
                <p className="services-subtitle-mobile">
                  ÎãπÏã†Ïùò ÎßàÏùå Í±¥Í∞ïÏùÑ ÏúÑÌïú Ï≤¥Í≥ÑÏ†ÅÏù∏ Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú
                </p>
              </div>
              
              <div className="services-grid-mobile">
                <div className="service-card service-card-brain">
                  <div className="service-icon">üß†</div>
                  <h4 className="service-title">Ï†ÑÎ¨∏ ÏÉÅÎã¥</h4>
                  <p className="service-description">Í≤ΩÌóò ÎßéÏùÄ ÏÉÅÎã¥ÏÇ¨ÏôÄÏùò 1:1 ÏÉÅÎã¥</p>
                </div>

                <div className="service-card service-card-mobile">
                  <div className="service-icon">üì±</div>
                  <h4 className="service-title">Ìé∏Î¶¨Ìïú Ï†ëÍ∑º</h4>
                  <p className="service-description">Ïñ∏Ï†ú Ïñ¥ÎîîÏÑúÎÇò ÏÉÅÎã¥ ÏòàÏïΩ Î∞è ÏßÑÌñâ</p>
                </div>

                <div className="service-card service-card-security">
                  <div className="service-icon">üîí</div>
                  <h4 className="service-title">ÏïàÏ†ÑÌïú Î≥¥Ïïà</h4>
                  <p className="service-description">Í∞úÏù∏Ï†ïÎ≥¥ Î≥¥Ìò∏ Î∞è ÏïîÌò∏Ìôî</p>
                </div>

                <div className="service-card service-card-chat">
                  <div className="service-icon">üí¨</div>
                  <h4 className="service-title">Ïã§ÏãúÍ∞Ñ Ï±ÑÌåÖ</h4>
                  <p className="service-description">ÏÉÅÎã¥ÏÇ¨ÏôÄÏùò Ï¶âÏãú ÏÜåÌÜµ</p>
                </div>
              </div>
            </div>

            <div className={`info-section ${isLoaded ? 'fade-in-up' : ''}`} style={{ animationDelay: '0.6s' }}>
              <div className="info-content">
                <h3 className="info-title">ÏÉÅÎã¥ ÏÑúÎπÑÏä§ Ïù¥Ïö© ÏïàÎÇ¥</h3>
                <ul className="info-list">
                  <li>‚Ä¢ ÏÉÅÎã¥ ÏòàÏïΩÏùÄ Î°úÍ∑∏Ïù∏ ÌõÑ Í∞ÄÎä•Ìï©ÎãàÎã§</li>
                  <li>‚Ä¢ ÏÉÅÎã¥ ÏãúÍ∞ÑÏùÄ 50Î∂ÑÏù¥Î©∞, ÏÇ¨Ï†Ñ ÏòàÏïΩÏ†úÏûÖÎãàÎã§</li>
                  <li>‚Ä¢ Í∞úÏù∏Ï†ïÎ≥¥Îäî Ï≤†Ï†ÄÌûà Î≥¥Ìò∏Îê©ÎãàÎã§</li>
                  <li>‚Ä¢ ÏÉÅÎã¥ ÎÇ¥Ïö©ÏùÄ ÎπÑÎ∞ÄÏù¥ Î≥¥Ïû•Îê©ÎãàÎã§</li>
                </ul>
              </div>
            </div>
          </div>
        </main>
        
        {/* Í≥µÌÜµ ÌïòÎã® ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò */}
        <TabletBottomNavigation userRole={null} />
      </div>
    </CommonPageTemplate>
  );
};

export default TabletHomepage;
