# MindGarden 상담 관리 시스템

## 🚀 프로젝트 개요

MindGarden은 상담사와 내담자를 위한 통합 상담 관리 시스템입니다. Spring Boot 백엔드와 React 프론트엔드로 구성되어 있으며, OAuth2 소셜 로그인을 지원합니다.

## ⚠️ 중요: 설정 파일 백업

**개발 환경 설정이 손실될 경우를 대비해 백업본을 제공합니다:**

### 로컬 개발 환경
- **원본**: `src/main/resources/application-local.yml`
- **백업본**: `src/main/resources/application-local.yml.backup`

### 운영 환경
- **원본**: `src/main/resources/application-prod.yml`
- **백업본**: `src/main/resources/application-prod.yml.backup`

**설정 파일 복원:**
```bash
# 로컬 환경 복원
cp src/main/resources/application-local.yml.backup src/main/resources/application-local.yml

# 운영 환경 복원
cp src/main/resources/application-prod.yml.backup src/main/resources/application-prod.yml
```

**자세한 환경 설정 가이드**: [환경별 설정 가이드](docs/ENVIRONMENT_SETUP.md)

## ✨ 주요 기능

### 🗄️ PL/SQL 통합 시스템 (NEW!)
- **통계 관리 PL/SQL**: 일별/월별 통계 자동 업데이트, 상담사 성과 분석, 실시간 모니터링
- **급여 관리 PL/SQL**: 통합 급여 계산, 세금 처리, ERP 동기화, 재무 거래 자동 생성
- **할인 회계 PL/SQL**: 패키지 할인 처리, 환불 관리, 수익/할인 분리 회계
- **매핑-세션 통합 PL/SQL**: 세션 동기화, 매핑 무결성 검증, 환불 시 세션 조정
- **Java-PL/SQL 연동**: JdbcTemplate 기반 프로시저 호출, 예외 처리, Fallback 메커니즘
- **실시간 자동화**: 이벤트 기반 업데이트, 스케줄러 서비스, 성능 모니터링

### 💰 급여 관리 시스템 (NEW! 2025-01-11 개편)
- **급여 배치 처리 시스템**: 매월 기산일 자동 급여 계산 및 저장
- **소득세율표 차등 적용**: 6단계 구간별 소득세율 (6%~42%) 자동 적용
- **실시간 미리보기 시스템**: 저장하지 않고 계산 결과만 표시
- **정확한 세금 계산**: 
  - 일반 프리랜서: 원천징수 3.3%만
  - 사업자 등록 프리랜서: 원천징수 3.3% + 부가세 10%
  - 정규직: 소득세 (구간별 차등) + 4대보험 (연봉 1200만원 이상)
- **ERP 실시간 동기화**: 급여 지급 시 회계 시스템 자동 업데이트
- **실시간 성과 기반 계산**: 상담 완료 건수, 고객 만족도, 보너스 반영
- **급여 프로필 관리**: 상담사별 급여 프로필 생성 및 관리
- **지점별 급여 관리**: 지점별 급여 현황 및 통계 분석

### 🔐 인증 및 보안
- **OAuth2 소셜 로그인**: 카카오, 네이버 지원
- **세션 기반 인증**: Spring Security + HttpSession
- **개인정보 암호화**: AES 암호화로 사용자 데이터 보호
- **CORS 설정**: 프론트엔드-백엔드 간 안전한 통신
- **비밀번호 찾기/재설정 시스템**: 이메일 기반 보안 토큰 시스템
- **개인정보 수집/이용 동의 시스템**: GDPR 준수 개인정보 보호

### 👥 사용자 관리
- **역할 기반 접근 제어**: CLIENT, CONSULTANT, ADMIN, SUPER_ADMIN
- **프로필 관리**: 사용자 정보 수정 및 관리
- **세션 관리**: 자동 세션 확인 및 관리
- **공통 리다이렉션 시스템**: 역할별 대시보드 경로 중앙 관리

### 💖 상담사 하트 평가 시스템 (NEW!)
- **하트 점수 평가**: 내담자가 완료된 상담에 대해 1-5 하트 점수 부여
- **평가 태그 시스템**: 친절해요, 전문적이에요, 도움이 되었어요 등 다양한 태그 선택
- **익명 평가 옵션**: 실명 또는 익명으로 평가 선택 가능
- **평가 코멘트**: 최대 500자 상세 평가 의견 작성
- **평가 통계**: 상담사별 평균 점수, 총 평가 수, 점수 분포 제공
- **평가 랭킹**: 전체 상담사 평균 점수 기준 랭킹 시스템
- **데이터 무결성**: 중복 평가 방지, 본인 상담만 평가 가능
- **자동 목록 관리**: 평가 완료 후 해당 상담 자동 제거
- **관리자 통계 대시보드**: 전체 평가 현황, TOP 5 랭킹, 7일 동향 차트
- **활성 상담사 필터링**: 비활성 상담사 자동 제외로 정확한 통계 제공

### 📱 카카오 알림톡 시스템 (NEW!)
- **공통 코드 기반 템플릿 관리**:
  - ALIMTALK_TEMPLATE: 상담 확정, 환불 완료, 일정 변경, 결제 완료 등
  - 파라미터 치환 시스템 (#{변수명} → 실제 값 자동 변환)
  - 데이터베이스에서 템플릿 동적 관리 (코드 수정 없이 변경 가능)
- **통합 알림 시스템**:
  - 우선순위별 알림 발송 (HIGH: 알림톡→SMS, MEDIUM: SMS→알림톡)
  - 사용자별 알림 설정 (카카오 로그인 사용자 자동 감지)
  - 대체 발송 시스템 (실패 시 자동으로 다른 방식 시도)
- **환경별 설정 분리**:
  - 시뮬레이션 모드: API 키 없이도 개발/테스트 가능
  - 실제 모드: 운영 환경에서 실제 알림톡 발송
  - 환경 변수 기반 보안 관리
- **테스트 API 지원**: 개발 단계에서 모든 알림 방식 테스트 가능

### 💸 환불 관리 시스템
- **안전한 내담자 삭제**: 회기 소진 또는 환불 처리 전까지 삭제 방지
- **다중 환불 처리 방법**:
  - 내담자 관리: 여러 매핑 동시 선택 환불 (전체 환불)
  - 매핑 관리: 개별 매핑 단위 환불 (부분 환불)
- **완전 자동화 환불 프로세스**:
  - 매핑 종료 → 스케줄 취소 → ERP 연동 → 알림톡 발송 → 데이터 새로고침
- **공통 코드 기반 환불 시스템**:
  - REFUND_PERIOD: 환불 통계 기간 설정
  - REFUND_REASON: 표준화된 환불 사유 (키워드 매칭)
  - REFUND_STATUS: 환불 처리 상태 (색상 포함)
- **ERP 연동 환불**: 환불 처리 시 자동 ERP 데이터 전송
- **환불 통계 대시보드**: 실시간 환불 현황 및 사유별 분석
- **환불 이력 관리**: 페이징 지원 환불 이력 조회 및 ERP 상태 추적
- **회계 연동**: ERP 시스템과 완벽 연동으로 회계 처리 자동화
- **데이터 정합성**: 비활성 상담사와의 스케줄 처리 개선

### 🔄 상담사 관리 시스템
- **안전한 삭제 시스템**: 연관 데이터 확인 후 이전 처리
- **상담사 이전 기능**: 매핑, 스케줄, 회기 정보 완전 이전
- **데이터 무결성**: 트랜잭션 기반 안전한 처리
- **실시간 업데이트**: 이전 후 관련 컴포넌트 자동 새로고침

### 📱 사용자 인터페이스
- **반응형 디자인**: 태블릿 최적화
- **컴포넌트 기반 구조**: 재사용 가능한 UI 컴포넌트
- **실시간 업데이트**: WebSocket 지원 (구현 예정)

### 🎨 UI/UX 개선
- **스케줄 등록 시스템**: 직관적인 시간 선택 그리드 및 드롭다운
- **한글 인코딩 지원**: UTF-8 완전 지원으로 한글 텍스트 정상 표시
- **인라인 스타일링**: CSS 충돌 방지 및 안정적인 UI 렌더링
- **색상 원 아이콘**: 이모지 대신 색상 원으로 상태 표시

### 🚀 성능 최적화
- **API 호출 최적화**: 일괄 처리 패턴으로 429 오류 해결
- **Rate Limiting**: 개발 환경용 임계값 조정
- **컴포넌트 최적화**: 불필요한 API 호출 제거 및 Props 기반 데이터 전달

### 🏖️ 휴가 관리 시스템
- **세밀한 휴가 유형**: 2시간 단위 반반차 휴가 지원
- **관리자 휴가 등록**: 관리자가 상담사 휴가 직접 등록
- **스마트 스케줄 제한**: 휴가 시간대 자동 제한
- **직관적 휴가 표시**: 이모지와 시간 범위로 명확한 표시

### 🏢 ERP 시스템
- **아이템 관리**: 구매 가능한 아이템 등록 및 재고 관리
- **구매 요청 시스템**: 상담사 구매 요청 및 승인 프로세스
- **구매 주문 관리**: 발주 및 배송 관리
- **예산 관리**: 부서별 예산 설정 및 추적
- **환불 관리**: 상담 환불 현황 및 ERP 연동 관리 (NEW!)
- **통합 회계 시스템**: 수입/지출, 대차대조표, 손익계산서
- **역할 기반 접근**: 어드민/수퍼어드민 권한별 기능 분리

### 💰 급여 관리 시스템 (NEW!)
- **상담사 등급별 기본급여 자동 계산**: 주니어(30,000원) ~ 마스터(45,000원)
- **프리랜서/정규직 급여 계산**: 상담 완료 건수 기반 자동 계산
- **세금 계산**: 사업자 등록 여부에 따른 차등 세금 적용
- **급여 프로필 관리**: 상담사별 급여 설정 및 관리
- **급여 출력**: PDF/Excel 급여 계산서 생성 및 이메일 전송
- **상담 유형별 옵션 금액**: 초기상담, 가족상담 등 자동 옵션 적용

## 🏗️ 기술 스택

### Backend
- **Spring Boot 3.2.0**: Java 17 기반
- **Spring Security**: 인증 및 권한 관리
- **Spring Data JPA**: 데이터베이스 접근
- **MySQL**: 데이터베이스
- **Redis**: 캐시 및 세션 관리
- **Maven**: 빌드 도구

### Frontend
- **React 19.1.1**: 사용자 인터페이스
- **React Router**: 클라이언트 사이드 라우팅
- **Bootstrap Icons**: 아이콘 라이브러리
- **CSS3**: 스타일링

## 🚀 개발 환경 설정

### 필수 요구사항
- Java 17+
- Node.js 18+
- MySQL 8.0+

### 백엔드 실행
```bash
# 프로젝트 루트에서
mvn spring-boot:run -Dspring.profiles.active=dev
```

### 프론트엔드 실행
```bash
# frontend 디렉토리에서
npm start
```

### 동시 실행 (추천)
```bash
# 프로젝트 루트에서
npm run dev
```

## 📁 프로젝트 구조

```
mindGarden/
├── src/main/java/com/mindgarden/consultation/
│   ├── config/           # Spring Security, CORS 설정
│   ├── controller/       # REST API 컨트롤러
│   ├── entity/          # JPA 엔티티
│   ├── service/         # 비즈니스 로직
│   └── util/            # 암호화, 세션 관리 유틸리티
├── frontend/src/
│   ├── components/      # React 컴포넌트
│   ├── hooks/          # 커스텀 React 훅
│   ├── utils/          # 유틸리티 함수
│   └── styles/         # CSS 스타일
├── test-data/           # 테스트 관련 파일 (쿠키, 세션, 로그 등)
├── sql-scripts/         # SQL 스크립트 (DDL, DML, 마이그레이션)
├── config/              # 설정 파일 (예시, GitHub, 쉘 스크립트)
└── docs/                # 프로젝트 문서
```

### 📋 파일 정리 가이드
- **자동 정리**: `./scripts/cleanup-project.sh` 실행
- **상세 가이드**: [PROJECT_FILE_ORGANIZATION.md](PROJECT_FILE_ORGANIZATION.md) 참조

## 🔧 구현된 기능

### ✅ 완료된 기능
1. **OAuth2 소셜 로그인**
   - 카카오 로그인 구현
   - 네이버 로그인 구현
   - 공통 OAuth2 컨트롤러

2. **세션 관리**
   - Spring Boot 세션 기반 인증
   - React 프론트엔드 세션 관리
   - 자동 세션 확인 및 갱신
   - 중복 로그인 방지 시스템

3. **사용자 인터페이스**
   - 태블릿 최적화 대시보드
   - 반응형 헤더 및 네비게이션
   - 웰컴 섹션 및 기본 레이아웃
   - 공통 레이아웃 컴포넌트

4. **보안 기능**
   - 개인정보 암호화/복호화
   - CORS 설정
   - Spring Security 설정

5. **ERP 시스템**
   - 아이템 관리 (등록, 수정, 삭제, 재고 관리)
   - 구매 요청 시스템 (상담사 요청, 관리자 승인)
   - 구매 주문 관리 (발주, 배송 추적)
   - 예산 관리 (부서별 예산 설정)
   - 역할 기반 접근 제어

6. **캐시 시스템**
   - Redis 기반 비즈니스 캐시
   - 이중 캐시 구조 (Spring Cache + Redis 직접 접근)
   - 캐시별 TTL 설정 (사용자 60분, 스케줄 30분, 아이템 30분 등)
   - 자동 캐시 갱신 및 무효화
   - 패턴 기반 캐시 제거 기능

7. **중복 로그인 방지 시스템**
   - 세션 기반 중복 로그인 감지
   - 사용자 확인 모달을 통한 세션 종료 처리
   - 개발 환경에서 자동 비활성화
   - 운영 환경에서 사용자 친화적 확인 시스템

### 🚧 진행 중인 기능
1. **대시보드 기능**
   - 상담 데이터 표시
   - 통계 및 요약 정보
   - 최근 활동 내역

2. **프로필 관리**
   - 사용자 정보 수정
   - 프로필 이미지 업로드

### 📋 예정된 기능
1. **상담 관리**
   - 상담 일정 관리
   - 상담 기록 관리
   - 알림 시스템

2. **실시간 통신**
   - WebSocket 채팅
   - 실시간 알림

## 🌐 접속 정보

- **백엔드**: http://localhost:8080
- **프론트엔드**: http://localhost:3000
- **API 문서**: http://localhost:8080/api/auth/oauth2/config

## 🚀 개발 서버 시작

### 방법 1: 통합 스크립트 사용
```bash
./scripts/start-all.sh local dev
```

### 방법 2: 기존 개발 스크립트 사용
```bash
./config/shell-scripts/start-dev.sh
```

### 방법 3: 개별 실행
```bash
# 백엔드만 시작
./scripts/start-backend.sh local

# 프론트엔드만 시작
./scripts/start-frontend.sh dev
```

## 📚 문서

프로젝트의 상세한 문서는 다음을 참조하세요:

- **[급여 관리 시스템](SALARY_MANAGEMENT_SYSTEM.md)** - 급여 계산 및 관리 시스템 가이드
- **[개발 가이드](DEVELOPMENT_GUIDE.md)** - 개발 환경 설정 및 코딩 표준
- **[환경 설정](ENVIRONMENT_SETUP.md)** - 로컬/운영 환경 설정 가이드
- **[API 설계](API_DESIGN.md)** - REST API 명세서
- **[시스템 설계](SYSTEM_DESIGN.md)** - 아키텍처 및 설계 문서
- **[운영 가이드](OPERATION_DEPLOYMENT_GUIDE.md)** - 배포 및 운영 가이드
- **[공통 리다이렉션 시스템](COMMON_REDIRECTION_SYSTEM.md)** - 역할별 대시보드 리다이렉션 시스템

## 📝 개발 가이드

### 코드 스타일
- **Java**: Google Java Style Guide 준수
- **JavaScript**: ESLint 규칙 준수
- **CSS**: BEM 방법론 사용

### 커밋 메시지
```
feat: 새로운 기능 추가
fix: 버그 수정
docs: 문서 수정
style: 코드 스타일 변경
refactor: 코드 리팩토링
test: 테스트 코드 추가
chore: 빌드 프로세스 변경
```

## 🤝 기여 방법

1. Fork the repository
2. Create your feature branch (`git checkout -b feature/AmazingFeature`)
3. Commit your changes (`git commit -m 'Add some AmazingFeature'`)
4. Push to the branch (`git push origin feature/AmazingFeature`)
5. Open a Pull Request

## 📄 라이선스

이 프로젝트는 MIT 라이선스 하에 배포됩니다. 자세한 내용은 [LICENSE](LICENSE) 파일을 참조하세요.

## 👥 팀원

- **개발**: MindGarden Team
- **문서**: AI Assistant

## 📞 문의

프로젝트에 대한 문의사항이 있으시면 이슈를 등록해 주세요.

---

**마지막 업데이트**: 2025년 8월 28일
**버전**: 1.0.0
