# 온보딩 등록 페이지 구현 계획 (초안)

> 상위 개요: `docs/mgsb/feature/ONBOARDING_AND_BILLING_OVERVIEW.md` 참고 (End-to-End 여정 및 로드맵)

작성일: 2025-11-13  
담당: 운영 포털 v1 팀

---

## 1. 배경
- 현재 내부 운영 포털(`/onboarding`)은 **심사/결정** 기능만 제공하며, 외부 입점사나 HQ 지점 직원이 직접 신청할 수 있는 UI가 없다.
- 운영팀이 직접 API를 호출해야 하는 번거로움이 있으므로, **외부에서 접근 가능한 온보딩 신청 페이지**가 필요하다.
- MindGarden 본 서비스(앱/웹)의 인증 체계를 향후 연동하기 위해 구조를 명확히 정의해야 한다.

---

## 2. 목표
1. 입점사/지점 담당자가 쉽게 접근해 신청 정보를 제출할 수 있는 페이지 제공.
2. 제출된 데이터는 기존 백엔드 API (`POST /api/v1/onboarding/requests`)로 저장.
3. **요금제/애드온 선택 및 정기 결제를 위한 결제 수단 등록**을 함께 수행.
4. 내부 운영 포털에서는 지금처럼 `/onboarding` 화면에서 심사/결정을 수행.
5. 추후 SSO와 MindGarden 본 서비스에 통합할 수 있도록 확장 가능한 구조 유지.

---

## 3. 범위
### 3.1 기능 범위
- 온보딩 신청 폼 (기본 정보 입력, 파일 업로드는 Phase 2 이후 고려)
- **요금제/애드온 선택, 정기 결제 PG 연동을 통한 결제 수단 등록**
- 제출 성공/실패 피드백
- 간단한 검증 (필수 값, 이메일 형식 등)
- 자동 알림(이메일/슬랙 등)은 Phase 2 고려

### 3.2 제외 범위 (Phase 1)
- SSO/로그인 연동 (추후 통합 예정)
- 복잡한 워크플로우(승인 전 파일 첨부, 추가 인터뷰 등)
- 첨부 파일 업로드 (추후 필요 시 도입)

---

## 4. 사용자 시나리오 (확장)
1. 입점사 담당자가 MindGarden 외부 URL (예: `https://apply.m-garden.co.kr/onboarding`)에 접속한다.
2. 회사/지점 기본 정보, 담당자 정보, 필요 체크리스트를 입력한다.
3. **요금제와 애드온을 선택하고, 결제 수단(카드)을 등록한다.**  
   - 첫 결제(선결제 또는 승인 보류)는 정책에 따라 진행
   - PG사(Stripe, 토스페이먼츠 등) 토큰화 방식 활용
4. 제출하면 백엔드 API에 온보딩 요청 + 결제/구독 정보가 저장된다.
5. 운영 포털 `/onboarding` 목록에 항목이 나타나며, 운영팀이 심사한다.
6. 승인 결과 및 결제 상태는 추후 이메일/앱 푸시로 통지하는 것을 목표로 한다(Phase 2).

---

## 5. 기술 설계 초안
### 5.1 프런트엔드
- 경량 Next.js/React 페이지 또는 MindGarden 기존 앱 내 메뉴로 구현.
- API 호출:
  - `POST /api/v1/onboarding/requests`
  - **`POST /api/v1/billing/subscribe` (가칭, 결제 수단 토큰 + 요금제 정보를 전달)**
- 응답 구조: 200 성공 시 등록 ID/구독 ID 반환, 400/401/500 시 오류 메시지 표시
- Validation: client-side + server-side (백엔드에서 재검증)

### 5.2 백엔드
- 기존 API 재사용 (`OnboardingController#createRequest`)
- 필요 시 필드 확장: 업종, 지역, 채널, 서류 리스트 등
- **PG 연동 및 구독(Subscription) 도메인 설계**
- **정기 결제 스케줄러(배치) + 결제 실패 처리 로직**
- 감사 로그: 자동 기록 (기존 `OnboardingService`가 감사지원 시 연동)
- Rate limiting / Captcha 등 악성 요청 대비는 추후 도입

### 5.3 접근 제어
- Phase 1: 임시 공개 URL, 간단한 안내 + 확인용 이메일 주소 수집
- Phase 2: MindGarden 계정으로 로그인한 상태에서만 제출 가능하도록 확장 (SSO)

---

## 6. UX 요구사항 (초안)
- 필드:
  - 테넌트 ID/명 (필수)
  - 업종/카테고리 (선택)
  - 담당자 이름/이메일/전화번호 (필수)
  - 요청 경위/특이사항 (선택)
  - 체크리스트 선택 (기본 2~3개, JSON 배열로 전송)
  - **요금제/애드온 선택 UI (라디오/체크박스)**
  - **결제 정보 입력(카드 번호, 만료, CVC) → PG 토큰화 처리**
- 안내 문구:
  - “승인까지 최대 3영업일 소요”
  - “결제는 승인 시점 또는 신청 시점에 자동으로 처리됩니다” (전략에 따라 문구 조정)
  - “문의: ops@mindgarden.com”
- 제출 후:
  - 성공 메시지 + 접수 ID 표기
  - 실패 시 상세 오류 메시지 (필수 항목 누락, 서버 오류 등)

---

## 7. 개발 일정 (가안)
| 단계 | 일정 | 주요 작업 |
| --- | --- | --- |
| 요구사항 확정 | T+0~2일 | 시나리오/필드 목록 확정, 결제 플로우 검토 |
| 디자인 시안 | T+3~7일 | UI 와이어프레임 + 결제 UX 설계 |
| 백엔드 설계 | T+3~7일 | PG 연동/구독 도메인, 배치 설계 |
| 프런트 구현 | T+8~16일 | 신청/결제 폼, 유효성 검증, 에러 처리 |
| 백엔드 구현 | T+8~16일 | API 확장, 결제 스케줄링, 감사 로그 |
| QA & 피드백 | T+17~21일 | 결제 성공/실패/취소 시나리오 테스트 |
| 배포 | T+22일 | staging → prod |

---

## 8. 추후 과제
- SSO 연동(Identity Hub) → MindGarden 계정 기반 신청.
- 첨부파일 업로드 (사업자등록증 등) → Blob Storage 연동.
- 자동 알림 (온보딩 접수 알림 → Slack/메일, 결제 실패 알림).
- 신청 현황 조회/수정 기능 (입점사에서 진행상태 확인).
- **구독 변경/취소, 결제 수단 변경 UI**
- **정기 결제 실패/재시도/정지 처리 정책 수립**

---

## 9. 참고 문서
- `docs/mgsb/internal-ops/phase1/functional-spec.md`
- `docs/mgsb/internal-ops/phase1/api-contract.yaml`
- `docs/mgsb/internal-ops/phase1/test-plan.md`
- `docs/mgsb/internal-ops/ENV_SETUP.md`


