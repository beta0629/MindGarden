name: ğŸ” ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬

on:
  pull_request:
    branches: [ main, develop ]
  push:
    branches: [ main, develop ]
  workflow_dispatch:

jobs:
  code-quality:
    name: ğŸ“Š ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ ì½”ë“œ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v4
      
    - name: â˜• Java 17 ì„¤ì •
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        
    - name: ğŸ“¦ Node.js 20 ì„¤ì •
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'
        cache-dependency-path: frontend/package-lock.json
        
    - name: ğŸ”§ Maven ìºì‹œ ì„¤ì •
      uses: actions/cache@v3
      with:
        path: ~/.m2
        key: ${{ runner.os }}-m2-${{ hashFiles('**/pom.xml') }}
        restore-keys: ${{ runner.os }}-m2
        
    - name: ğŸ” Checkstyle ê²€ì‚¬
      run: |
        mvn checkstyle:check || true
        echo "Checkstyle ê²€ì‚¬ ì™„ë£Œ"
        
    - name: ğŸ› SpotBugs ê²€ì‚¬
      run: |
        mvn spotbugs:check || true
        echo "SpotBugs ê²€ì‚¬ ì™„ë£Œ"
        
    - name: ğŸ” í•˜ë“œì½”ë”© ê²€ì‚¬
      run: |
        node scripts/check-hardcoding-enhanced.js || exit 1
        
    - name: ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹¤í–‰
      run: |
        mvn test -Dspring.profiles.active=test || true
        
    - name: ğŸ“Š ì½”ë“œ í’ˆì§ˆ ë©”íŠ¸ë¦­ ìˆ˜ì§‘
      run: |
        node scripts/collect-code-quality-metrics.js || true
        
    - name: ğŸ“„ ì½”ë“œ í’ˆì§ˆ ë¦¬í¬íŠ¸ ìƒì„±
      run: |
        node scripts/generate-code-quality-report.js || true
        
    - name: ğŸ“¤ ë¦¬í¬íŠ¸ ì—…ë¡œë“œ
      uses: actions/upload-artifact@v3
      if: always()
      with:
        name: code-quality-reports
        path: |
          test-reports/hardcoding/
          test-reports/code-quality/
          test-reports/code-quality-reports/
        retention-days: 30

