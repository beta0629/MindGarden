# 역할별 권한 매트릭스

**작성일**: 2025-11-20  
**버전**: 1.0.0  
**상태**: 완료

---

## 📋 개요

역할별 권한 매트릭스는 **범용적인 패턴**을 제공하며, 실제 입점사는 자신만의 권한 구조를 가질 수 있습니다. MindGarden은 CONSULTATION 업종의 예시입니다.

---

## 🔐 권한 범위 (Scope)

### 권한 범위 종류

| 범위 | 설명 | 예시 |
|------|------|------|
| SELF | 자신의 데이터만 접근 | 내담자: 자신의 상담 내역만 조회 |
| BRANCH | 브랜치 내 데이터 접근 | 상담사: 자신의 브랜치 내담자만 관리 |
| TENANT | 테넌트 전체 데이터 접근 | 관리자: 테넌트 전체 통계 조회 |
| ALL | 모든 데이터 접근 | HQ 관리자: 모든 테넌트 데이터 접근 |

---

## 📊 범용 권한 패턴

### 레벨별 기본 권한 패턴

#### 레벨 1: 기본 사용자 (필수)

**권한 범위**: SELF

**기본 권한:**
- 자신의 데이터 조회
- 자신의 일정 조회
- 자신의 기록 조회
- 프로필 수정

**예시:**
- 학원: 학생 - 자신의 출석, 성적 조회
- 상담소: 내담자 - 자신의 상담 내역 조회

#### 레벨 2: 서비스 제공자 (필수)

**권한 범위**: BRANCH (일반), TENANT (선택)

**기본 권한:**
- 할당된 사용자 관리
- 서비스 제공 (상담, 수업 등)
- 기록 작성
- 일정 관리

**예시:**
- 학원: 교사 - 담당 반 학생 관리, 출석 체크, 성적 입력
- 상담소: 상담사 - 할당된 내담자 관리, 상담 기록 작성

#### 레벨 3: 관리자 (옵션)

**권한 범위**: TENANT

**기본 권한:**
- 테넌트 전체 사용자 관리
- 통계 조회
- 설정 관리
- 결제 관리

**예시:**
- 학원: 관리자 - 전체 학생/교사 관리, 통계 조회
- 상담소: 관리자 - 전체 내담자/상담사 관리, 통계 조회

#### 레벨 4: 최고 관리자 (옵션)

**권한 범위**: TENANT (모든 권한)

**기본 권한:**
- 레벨 3의 모든 권한
- 역할 관리
- 시스템 설정
- 모든 데이터 접근

**예시:**
- 학원: 원장 - 모든 권한
- 상담소: 원장 - 모든 권한

---

## 🎯 업종별 권한 예시

### ACADEMY (학원)

| 역할 | 권한 범위 | 주요 권한 |
|------|----------|----------|
| 원장 | TENANT | 모든 권한 (학생/교사 관리, 통계, 설정) |
| 교사 | BRANCH | 담당 반 학생 관리, 출석 체크, 성적 입력 |
| 학생 | SELF | 자신의 출석/성적 조회, 수강 신청 |
| 학부모 | SELF | 자녀 출석/성적 조회 |
| 사무원 | TENANT | 수강 등록, 결제 관리, 통계 조회 |

### CONSULTATION (상담소)

| 역할 | 권한 범위 | 주요 권한 |
|------|----------|----------|
| 원장 | TENANT | 모든 권한 (내담자/상담사 관리, 통계, 설정) |
| 상담사 | BRANCH | 할당된 내담자 관리, 상담 기록 작성, 일정 관리 |
| 내담자 | SELF | 자신의 상담 내역 조회, 상담 예약, 결제 |
| 사무원 | TENANT | 상담 예약 관리, 결제 관리, 통계 조회 |

**참고**: MindGarden은 CONSULTATION 업종의 예시입니다.

---

## 🔧 ABAC 정책 (policy_json)

### 브랜치별 권한 예시

**예시 1: 본원 상담사 (모든 브랜치 접근)**
```json
{
  "scope": "TENANT",
  "all_branches": true
}
```

**예시 2: 분원 상담사 (자신의 브랜치만)**
```json
{
  "scope": "BRANCH",
  "branch_id": "${user.branchId}",
  "own_branch_only": true
}
```

**예시 3: 특정 브랜치만 접근**
```json
{
  "scope": "BRANCH",
  "allowed_branch_ids": [1, 2, 3]
}
```

---

## 📝 권한 매트릭스 표

### 범용 권한 패턴

| 기능 | 레벨 1 | 레벨 2 | 레벨 3 | 레벨 4 |
|------|--------|--------|--------|--------|
| 자신의 데이터 조회 | ✅ | ✅ | ✅ | ✅ |
| 할당된 사용자 관리 | ❌ | ✅ | ✅ | ✅ |
| 전체 사용자 관리 | ❌ | ❌ | ✅ | ✅ |
| 통계 조회 | ❌ | ❌ (제한적) | ✅ | ✅ |
| 설정 관리 | ❌ | ❌ | ❌ | ✅ |
| 역할 관리 | ❌ | ❌ | ❌ | ✅ |

**참고**: 실제 권한은 입점사마다 다를 수 있습니다.

---

## ⚠️ 중요 사항

1. **범용 패턴 제공**
   - 이 문서는 범용적인 권한 패턴을 제공
   - 실제 입점사는 다른 권한 구조를 가질 수 있음

2. **MindGarden은 예시**
   - MindGarden의 권한은 CONSULTATION 업종의 예시
   - 다른 상담소는 다른 권한 구조를 가질 수 있음

3. **동적 권한 관리**
   - 테넌트 관리자가 권한 커스터마이징 가능
   - ABAC 정책으로 세밀한 권한 제어

---

## 🔗 관련 문서

- [동적 역할 시스템](./DYNAMIC_ROLE_SYSTEM.md)
- [역할 템플릿 가이드](./ROLE_TEMPLATE_GUIDE.md)
- [업종별 역할 예시](./ROLE_EXAMPLES.md)

---

**마지막 업데이트**: 2025-11-20

