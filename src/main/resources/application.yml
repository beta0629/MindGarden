# 통합 상담관리 시스템 설정 파일
# Spring Boot 3.x + Hibernate 6.x + MySQL 8.x

spring:
  profiles:
    active: local
  
  application:
    name: consultation-management-system
  
  # 데이터베이스 설정
  datasource:
    url: jdbc:mysql://localhost:3306/mindgarden_consultation?useSSL=false&serverTimezone=Asia/Seoul&characterEncoding=UTF-8&allowPublicKeyRetrieval=true
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:}
    driver-class-name: com.mysql.cj.jdbc.Driver
  
  # JPA 설정
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: false  # SQL 로그는 별도로 제어
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQL8Dialect
        format_sql: true
        use_sql_comments: true
        # 로그 레벨 분리 설정
        logging:
          level:
            org.hibernate.SQL: DEBUG          # SQL 쿼리만
            org.hibernate.type.descriptor.sql.BasicBinder: TRACE  # SQL 파라미터
            org.hibernate.engine.transaction.internal: DEBUG      # 트랜잭션
            org.hibernate.resource.transaction: DEBUG             # 트랜잭션 리소스
            org.hibernate.engine.jdbc.spi.SqlExceptionHelper: ERROR  # SQL 예외만
        # SQL 예외 상세 로깅
        jdbc:
          batch_size: 20
          batch_versioned_data: true
        # 스키마 업데이트 로깅
        hbm2ddl:
          auto: update
          import_files: false
    database-platform: org.hibernate.dialect.MySQL8Dialect
  
  # Thymeleaf 설정
  thymeleaf:
    cache: false
    mode: HTML
    encoding: UTF-8
    servlet:
      content-type: text/html
  
  # 보안 설정 (OAuth2 임시 비활성화)
  # security:
  #   oauth2:
  #     client:
  #       registration:
  #         kakao:
  #           client-id: ${KAKAO_CLIENT_ID:your-kakao-client-id}
  #           client-secret: ${KAKAO_CLIENT_SECRET:your-kakao-client-secret}
  #           redirect-uri: "{baseUrl}/login/oauth2/code/{registrationId}"
  #           client-authentication-method: post
  #           authorization-grant-type: authorization_code
  #           scope:
  #             - profile_nickname
  #             - account_email
  #           client-name: Kakao
  #         naver:
  #           client-id: ${NAVER_CLIENT_ID:your-naver-client-id}
  #           client-secret: ${NAVER_CLIENT_SECRET:your-naver-client-secret}
  #           redirect-uri: "{baseUrl}/login/oauth2/code/{registrationId}"
  #           client-authentication-method: post
  #           authorization-grant-type: authorization_code
  #           scope:
  #             - name
  #             - email
  #           client-name: Naver
  #         facebook:
  #           client-id: ${FACEBOOK_CLIENT_ID:your-facebook-client-id}
  #           client-secret: ${FACEBOOK_CLIENT_SECRET:your-facebook-client-secret}
  #           redirect-uri: "{baseUrl}/login/oauth2/code/{registrationId}"
  #           client-authentication-method: post
  #           authorization-grant-type: authorization_code
  #           scope:
  #             - name
  #             - email
  #           client-name: Facebook
  #         instagram:
  #           client-id: ${INSTAGRAM_CLIENT_ID:your-instagram-client-id}
  #           client-secret: ${INSTAGRAM_CLIENT_SECRET:your-instagram-client-secret}
  #           redirect-uri: "{baseUrl}/login/oauth2/code/{registrationId}"
  #           client-authentication-method: post
  #           authorization-grant-type: authorization_code
  #           scope:
  #             - basic
  #           client-name: Instagram

# JWT 설정
jwt:
  secret: ${JWT_SECRET:mindgarden-consultation-system-jwt-secret-key-2024}
  expiration: 86400000  # 24시간 (밀리초)
  refresh-expiration: 604800000  # 7일 (밀리초)

# 개인정보 암호화 설정
encryption:
  personal-info:
    key: ${PERSONAL_INFO_ENCRYPTION_KEY:mind_garden_2025}
    algorithm: AES-256
    transformation: AES/CBC/PKCS5Padding

# 서버 설정
server:
  port: ${SERVER_PORT:8080}
  servlet:
    context-path: /
    encoding:
      charset: UTF-8
      force: true
  compression:
    enabled: true
    mime-types: text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json
    min-response-size: 1024

# 로깅 설정
logging:
  level:
    # 애플리케이션 로그 (정상 로그 계속 남기기)
    com.mindgarden: INFO
    # Spring 관련 로그
    org.springframework.transaction: INFO
    org.springframework.orm.jpa: INFO
    # 데이터베이스 연결 로그
    com.zaxxer.hikari: INFO
    # SQL 관련 로그 (별도 파일로 분리)
    org.hibernate.SQL: INFO
    org.hibernate.type.descriptor.sql.BasicBinder: INFO
    org.hibernate.engine.transaction.internal: INFO
    org.hibernate.resource.transaction: INFO
    org.hibernate.engine.jdbc.spi.SqlExceptionHelper: ERROR
    # 기타 로그는 INFO 레벨로 (정상 로그 계속 남기기)
    root: INFO
  
  # 로그 파일 설정
  file:
    name: logs/mindgarden.log
    max-size: 100MB
    max-history: 30
  
  # 로그 패턴 설정
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"
  
  # SQL/데이터베이스 오류 로그 별도 파일
  config: classpath:logback-spring.xml

# Actuator 설정
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: when-authorized
  metrics:
    export:
      prometheus:
        enabled: true

# 파일 업로드 설정
file:
  upload:
    max-size: 10MB
    allowed-types: jpg,jpeg,png,gif,pdf,doc,docx
    upload-dir: ./uploads

# 상담 시스템 설정
consultation:
  system:
    name: "통합 상담관리 시스템"
    version: "1.0.0"
    max-clients-per-consultant: 20
    session-timeout: 30
    notification:
      enabled: true
      real-time: true
    dashboard:
      max-components: 12
      default-layout: "grid"
