# 휴가 시스템 업데이트 문서

## 개요
상담사 휴가 관리 시스템을 대폭 개선하여 더 세밀한 휴가 유형을 지원하고, 관리자가 휴가를 등록할 수 있는 기능을 추가했습니다.

## 주요 개발 내용

### 1. 새로운 반반차 휴가 유형 추가
기존의 단순한 "오전/오후 휴가"에서 더 세밀한 2시간 단위 반반차 휴가로 확장했습니다.

#### 새로운 휴가 유형
- **오전 반반차 1**: 09:00-11:00 (2시간)
- **오전 반반차 2**: 11:00-13:00 (2시간) 
- **오후 반반차 1**: 14:00-16:00 (2시간)
- **오후 반반차 2**: 16:00-18:00 (2시간)

#### 기존 휴가 유형 유지
- **오전 휴가**: 09:00-13:00 (4시간)
- **오후 휴가**: 14:00-18:00 (4시간)
- **하루 종일 휴가**: 09:00-18:00
- **사용자 정의 휴가**: 임의 시간 설정

### 2. 관리자 휴가 등록 기능
관리자가 상담사의 휴가를 직접 등록할 수 있는 기능을 추가했습니다.

#### 기능 특징
- 스케줄 페이지에서 "휴가 등록" 버튼으로 접근
- 상담사별 휴가 등록 가능
- 휴가 유형별 자동 시간 설정
- 휴가 사유 입력 기능

### 3. 스케줄 등록 시 휴가 시간 제한
상담사가 휴가 중인 시간대에는 스케줄 등록이 제한됩니다.

#### 제한 규칙
- **하루 종일 휴가**: 해당 상담사 선택 불가
- **오전/오후 휴가**: 해당 시간대 스케줄 등록 불가
- **반반차 휴가**: 해당 2시간 시간대만 스케줄 등록 불가
- **점심시간**: 13:00-14:00은 항상 사용 가능

### 4. 휴가 정보 표시 개선
캘린더와 상세 모달에서 휴가 정보를 더 명확하게 표시합니다.

#### 표시 내용
- 휴가 유형별 정확한 시간 범위
- 휴가 사유
- 승인 상태
- 이모지를 활용한 직관적 표시

## 기술적 구현

### 백엔드 변경사항

#### 1. VacationType Enum 확장
```java
public enum VacationType {
    MORNING("오전 휴가 (09:00-13:00)"),
    MORNING_HALF_1("오전 반반차 1 (09:00-11:00)"),
    MORNING_HALF_2("오전 반반차 2 (11:00-13:00)"),
    AFTERNOON("오후 휴가 (14:00-18:00)"),
    AFTERNOON_HALF_1("오후 반반차 1 (14:00-16:00)"),
    AFTERNOON_HALF_2("오후 반반차 2 (16:00-18:00)"),
    CUSTOM_TIME("사용자 정의 휴가"),
    ALL_DAY("하루 종일 휴가"),
    FULL_DAY("하루 종일 휴가");
}
```

#### 2. 휴가 시간 확인 로직 개선
`ConsultantAvailabilityServiceImpl`에서 각 휴가 유형별로 정확한 시간 범위를 확인합니다.

#### 3. 데이터베이스 스키마 업데이트
- `vacations` 테이블의 `vacation_type` ENUM 확장
- 새로운 휴가 유형 코드 값 추가
- 기존 데이터 마이그레이션

### 프론트엔드 변경사항

#### 1. 휴가 등록 모달
- `VacationManagementModal.js`: 새로운 반반차 유형 지원
- 자동 시간 설정 기능
- 사용자 친화적 UI

#### 2. 시간 슬롯 그리드
- `TimeSlotGrid.js`: 휴가 시간 확인 로직 개선
- API 응답 구조 수정
- 정확한 시간대별 사용 가능/불가능 표시

#### 3. 스케줄 상세 모달
- `ScheduleDetailModal.js`: 휴가 유형별 표시 개선
- 이모지와 시간 범위 표시

## API 엔드포인트

### 휴가 관련 API
- `GET /api/consultant/vacations?date={date}`: 특정 날짜의 휴가 정보 조회
- `POST /api/consultant/{consultantId}/vacation`: 휴가 등록
- `GET /api/admin/consultants/with-vacation?date={date}`: 관리자용 상담사 목록 (휴가 정보 포함)

### 스케줄 관련 API
- `GET /api/schedules?userId={userId}&userRole={role}&date={date}`: 스케줄 조회 (휴가 정보 포함)

## 데이터베이스 변경사항

### 1. ENUM 확장
```sql
ALTER TABLE vacations MODIFY COLUMN vacation_type 
ENUM('MORNING', 'MORNING_HALF_1', 'MORNING_HALF_2', 'AFTERNOON', 
     'AFTERNOON_HALF_1', 'AFTERNOON_HALF_2', 'CUSTOM_TIME', 'ALL_DAY', 'FULL_DAY') 
NOT NULL;
```

### 2. 코드 값 추가
새로운 휴가 유형에 대한 코드 값들을 `code_values` 테이블에 추가했습니다.

## 사용법

### 관리자 휴가 등록
1. 스케줄 페이지에서 원하는 날짜 클릭
2. "휴가 등록" 버튼 클릭
3. 상담사 선택
4. 휴가 유형 선택 (자동으로 시간 설정됨)
5. 휴가 사유 입력
6. 등록 완료

### 스케줄 등록 시 휴가 확인
1. 스케줄 등록 시 상담사 선택
2. 시간 슬롯에서 휴가 시간대는 비활성화 표시
3. 사용 가능한 시간대만 선택 가능

## 테스트 시나리오

### 1. 반반차 휴가 등록 테스트
- 각 반반차 유형별로 휴가 등록
- 시간 범위가 정확히 설정되는지 확인
- 캘린더에 올바르게 표시되는지 확인

### 2. 스케줄 등록 제한 테스트
- 휴가 중인 상담사 선택 시 시간 제한 확인
- 사용 가능한 시간대만 선택 가능한지 확인
- 점심시간(13:00-14:00)은 항상 사용 가능한지 확인

### 3. 휴가 정보 표시 테스트
- 캘린더에서 휴가 이벤트 클릭 시 상세 정보 표시
- 휴가 유형별 정확한 시간 범위 표시
- 이모지와 함께 직관적 표시 확인

## 향후 개선 사항

1. **휴가 승인 워크플로우**: 휴가 신청 → 승인 → 반려 프로세스
2. **휴가 통계**: 상담사별 휴가 사용 현황 통계
3. **휴가 알림**: 휴가 등록/변경 시 관련자 알림
4. **휴가 캘린더**: 휴가 전용 캘린더 뷰

## 마이그레이션 가이드

기존 시스템에서 업데이트 시 다음 사항을 확인해야 합니다:

1. 데이터베이스 ENUM 업데이트
2. 기존 휴가 데이터 마이그레이션
3. 코드 값 데이터 추가
4. 프론트엔드 빌드 및 배포

## 버그 수정

### 해결된 문제들
1. 휴가 정보가 스케줄 등록 시 제대로 반영되지 않던 문제
2. API 응답 구조 불일치로 인한 휴가 정보 로드 실패
3. 반반차 휴가 시 잘못된 시간대 제한 문제
4. 휴가 상세 모달에서 휴가 유형 표시 오류

## 개발자 노트

이 업데이트는 기존 시스템의 안정성을 유지하면서 새로운 기능을 추가하는 방식으로 진행되었습니다. 모든 변경사항은 하위 호환성을 고려하여 설계되었습니다.
